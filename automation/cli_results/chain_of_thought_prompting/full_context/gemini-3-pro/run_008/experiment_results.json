{
  "model": "gemini-3-pro",
  "strategy": "chain_of_thought_prompting",
  "context_type": "full_context",
  "timestamp": "2025-12-30T10:22:10.416815",
  "response_time": 156.13351106643677,
  "test_file": "cli_results\\chain_of_thought_prompting\\full_context\\gemini-3-pro\\run_008\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet.\n\nBelow is the full implementation of the class:\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict):\n    \"\"\"\n    Represents a single product entry in the order.\n\n:key name: The name of the product.\n    :key price: The price per unit of the product.\n    :key quantity: The number of units of the product.\n    \"\"\"\n    name: str\n    price: float\n    quantity: int\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n        \"\"\"\n        Initializes a new OrderCalculator instance.\n        Initializes an empty list of items (each represented as a TypedDict 'Item')\n        and stores the configured tax and shipping parameters.\n\n:param tax_rate: The percentage of tax applied to the final amount, expressed as a float between 0.0 and 1.0 (default is 0.23 for 23%).\n        :param free_shipping_threshold: The minimum order value (after discount) that qualifies for free shipping (default is 100.0).\n        :param shipping_cost: The cost of shipping applied if the order does not meet the free shipping threshold (default is 10.0).\n\n:raises ValueError:\n            - If tax_rate is not in the range [0.0, 1.0].\n            - If free_shipping_threshold is negative.\n            - If shipping_cost is negative.\n        :raises TypeError: If any parameter is of incorrect type.\n        \"\"\"\n        if not isinstance(tax_rate, (float, int)):\n            raise TypeError(\"Tax rate must be a float or int.\")\n        if not isinstance(free_shipping_threshold, (float, int)):\n            raise TypeError(\"Free shipping threshold must be a float or int.\")\n        if not isinstance(shipping_cost, (float, int)):\n            raise TypeError(\"Shipping cost must be a float or int.\")\n        if not 0.0 <= tax_rate <= 1.0:\n            raise ValueError(\"Tax rate must be between 0.0 and 1.0.\")\n        if free_shipping_threshold < 0.0:\n            raise ValueError(\"Free shipping threshold cannot be negative.\")\n        if shipping_cost < 0.0:\n            raise ValueError(\"Shipping cost cannot be negative.\")\n\nself.items: List[Item] = []\n        self.tax_rate = tax_rate\n        self.free_shipping_threshold = free_shipping_threshold\n        self.shipping_cost = shipping_cost\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n        \"\"\"\n        Add an item to the order.\n\nIf an item with the same name and price already exists, its quantity is increased.\n\n:param name: the name of the item\n        :param price: the price of the item\n        :param quantity: the quantity of the item (default is 1)\n        :raises ValueError: If name is empty, price <= 0, quantity < 1, or item with same name but different price exists.\n        :raises TypeError: If inputs are of incorrect types.\n        \"\"\"\n        if not isinstance(name, str):\n            raise TypeError(\"Item name must be a string.\")\n        if not isinstance(price, (float, int)):\n            raise TypeError(\"Price must be a number.\")\n        if not isinstance(quantity, int):\n            raise TypeError(\"Quantity must be an integer.\")\n        if not name:\n            raise ValueError(\"Item name cannot be empty.\")\n        if quantity < 1:\n            raise ValueError(\"Quantity must be at least 1.\")\n        if price <= 0:\n            raise ValueError(\"Price must be greater than 0.\")\n\nfor item in self.items:\n            if item[\"name\"] == name:\n                if item[\"price\"] != price:\n                    raise ValueError(\"Item with the same name but different price already exists.\")\n                item[\"quantity\"] += quantity\n                return\n\nself.items.append({\n            \"name\": name,\n            \"price\": price,\n            \"quantity\": quantity\n        })\n\ndef remove_item(self, name: str):\n        \"\"\"\n        Removes an item from the order.\n\n:param name: The name of the item to remove.\n        :raises ValueError: If no item with the given name exists in the order.\n        :raises TypeError: If name is not a string.\n        \"\"\"\n        if not isinstance(name, str):\n            raise TypeError(\"Item name must be a string.\")\n        if not any(item[\"name\"] == name for item in self.items):\n            raise ValueError(f\"Item with name '{name}' does not exist in the order.\")\n\nself.items = [item for item in self.items if item[\"name\"] != name]\n\ndef get_subtotal(self) -> float:\n        \"\"\"\n        Calculates the subtotal (sum of item prices times their quantities) for all items in the order.\n\n:return: The subtotal as a float.\n        :raises ValueError: If the order is empty.\n        \"\"\"\n        if not self.items:\n            raise ValueError(\"Cannot calculate subtotal on empty order.\")\n        return sum(item[\"price\"] * item[\"quantity\"] for item in self.items)\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n        \"\"\"\n        Applies a percentage discount to the given subtotal.\n\n:param subtotal: the subtotal amount (must be >= 0)\n        :param discount: the discount rate as a float between 0.0 and 1.0 (e.g. 0.2 = 20%).\n        :return: The discounted subtotal.\n        :raises ValueError: If subtotal < 0 or discount is outside the [0.0, 1.0] range.\n        :raises TypeError: If inputs are of incorrect types.\n        \"\"\"\n        if not isinstance(subtotal, (float, int)):\n            raise TypeError(\"Subtotal must be a number.\")\n        if not isinstance(discount, (float, int)):\n            raise TypeError(\"Discount must be a number.\")\n        if not 0.0 <= discount <= 1.0:\n            raise ValueError(\"Discount must be between 0.0 and 1.0.\")\n        if subtotal < 0.0:\n            raise ValueError(\"Cannot apply discount on negative subtotal.\")\n        return subtotal * (1 - discount)\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n        \"\"\"\n        Calculates the shipping cost based on the discounted subtotal.\n\nIf the discounted subtotal >= free shipping threshold shipping is free (0.0).\n        Otherwise, the standard shipping cost is applied.\n\n:param discounted_subtotal: The subtotal amount after applying discount (must be >= 0.0).\n        :return: The shipping cost as a float (0.0 or self.shipping_cost).\n        :raises TypeError: If input is not a number.\n        \"\"\"\n        if not isinstance(discounted_subtotal, (float, int)):\n            raise TypeError(\"Discounted subtotal must be a number.\")\n        if discounted_subtotal >= self.free_shipping_threshold:\n            return 0.0\n        return self.shipping_cost\n\ndef calculate_tax(self, amount: float) -> float:\n        \"\"\"\n        Calculates the tax based on the provided amount using the configured tax rate.\n\n:param amount: The amount on which to calculate the tax (must be >= 0.0).\n        :return: The tax as a float.\n        :raises ValueError: If the amount is negative.\n        :raises TypeError: If input is not a number.\n        \"\"\"\n        if not isinstance(amount, (float, int)):\n            raise TypeError(\"Amount must be a number.\")\n        if amount < 0.0:\n            raise ValueError(\"Cannot calculate tax on negative amount.\")\n        return amount * self.tax_rate\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n        \"\"\"\n        Calculates the total cost of the order after applying discount, shipping, and tax.\n\nThis method performs the following steps:\n        1. Calculates the subtotal from all items.\n        2. Applies the given discount.\n        3. Adds shipping cost if necessary.\n        4. Calculates tax on the discounted subtotal + shipping.\n\n:param discount: Discount rate between 0.0 and 1.0 (e.g. 0.2 = 20%).\n        :return: The final total as a float.\n        :raises ValueError:\n            - If the subtotal is negative.\n            - If the discount is invalid.\n            - If the order is empty.\n        :raises TypeError: If input is not a number.\n        \"\"\"\n        if not isinstance(discount, (float, int)):\n            raise TypeError(\"Discount must be a number.\")\n\nsubtotal = self.get_subtotal()\n        if subtotal < 0.0:\n            raise ValueError(\"Cannot calculate total on negative subtotal.\")\n        discounted_subtotal = self.apply_discount(subtotal, discount)\n        shipping_cost = self.calculate_shipping(discounted_subtotal)\n        tax = self.calculate_tax(discounted_subtotal + shipping_cost)\n        return discounted_subtotal + shipping_cost + tax\n\ndef total_items(self) -> int:\n        \"\"\"\n        Returns the total quantity of all items in the order.\n\n:return: The sum of the quantities of all items.\n        :return:\n        \"\"\"\n        return sum(item[\"quantity\"] for item in self.items)\n\ndef clear_order(self):\n        \"\"\"\n        Removes all items from the order, resetting it to an empty state.\n        \"\"\"\n        self.items = []\n\ndef list_items(self) -> List[str]:\n        \"\"\"\n        Returns a list of all unique item names currently in the order.\n\n:return: A list of unique item names (no duplicates).\n        \"\"\"\n        return list(set(item[\"name\"] for item in self.items))\n\ndef is_empty(self) -> bool:\n        \"\"\"\n        Checks whether the order is currently empty.\n\n:return: True if no items are in the order, False otherwise.\n        \"\"\"\n        return len(self.items) == 0\n```",
        "response": "Based on the analysis of the provided `OrderCalculator` class, here is the detailed plan for the unit tests. I have identified the key functionality and edge cases that need to be covered.\n\n### Test Plan Analysis\n\nThe `OrderCalculator` class contains state management (items list) and business logic (pricing, tax, shipping). The tests will be divided into logical groups to ensure full coverage of initialization, item management, individual calculation steps, and the final total integration.\n\n#### 1. Initialization Tests\n*   **Default Values:** Verify that an instance created without arguments has the default tax rate (0.23), free shipping threshold (100.0), and shipping cost (10.0).\n*   **Custom Values:** Verify that an instance stores provided custom values correctly.\n*   **Validation (Types):** Ensure `TypeError` is raised if `tax_rate`, `threshold`, or `shipping_cost` are not numbers.\n*   **Validation (Values):** Ensure `ValueError` is raised if:\n    *   `tax_rate` is outside [0.0, 1.0].\n    *   `free_shipping_threshold` is negative.\n    *   `shipping_cost` is negative.\n\n#### 2. Item Management Tests (`add_item`, `remove_item`)\n*   **Add New Item:** Verify an item is added to the list with correct name, price, and quantity.\n*   **Update Quantity:** Verify adding an item that already exists (same name and price) increments the quantity instead of creating a duplicate.\n*   **Price Conflict:** Verify `ValueError` is raised if adding an existing item name with a *different* price.\n*   **Input Validation:**\n    *   `ValueError` for empty name, price <= 0, or quantity < 1.\n    *   `TypeError` for incorrect data types.\n*   **Remove Item:** Verify an item is successfully removed from the list.\n*   **Remove Non-existent:** Verify `ValueError` is raised when trying to remove an item not in the order.\n\n#### 3. Calculation Logic Tests (Individual Methods)\n*   **Subtotal (`get_subtotal`):**\n    *   Verify correct summation of `price * quantity` for multiple items.\n    *   Verify `ValueError` is raised if called on an empty order.\n*   **Discount (`apply_discount`):**\n    *   Verify correct calculation (e.g., 20% off 100.0 is 80.0).\n    *   Verify `ValueError` for discount < 0.0 or > 1.0.\n    *   Verify `ValueError` for negative subtotal input.\n*   **Shipping (`calculate_shipping`):**\n    *   Verify returns `0.0` if subtotal >= threshold.\n    *   Verify returns configured `shipping_cost` if subtotal < threshold.\n*   **Tax (`calculate_tax`):**\n    *   Verify correct tax calculation on a given amount.\n    *   Verify `ValueError` for negative amount input.\n\n#### 4. Integration Tests (`calculate_total`)\n*   **Standard Flow:** Test a full scenario where shipping is applied (Subtotal - Discount + Shipping + Tax).\n*   **Free Shipping Flow:** Test a scenario where the discounted subtotal qualifies for free shipping.\n*   **Discount Impact:** Test a specific edge case where applying a discount drops the subtotal *below* the free shipping threshold, causing shipping costs to be added.\n*   **Empty Order:** Verify `ValueError` is propagated if called on an empty order.\n\n#### 5. Utility & State Tests\n*   **`total_items`:** Verify it returns the sum of all item quantities.\n*   **`clear_order`:** Verify the items list is emptied.\n*   **`list_items`:** Verify it returns a list of unique item names.\n*   **`is_empty`:** Verify it returns `True` initially and `False` after adding items.\n\nI am ready to proceed with writing the test code when you are ready.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Here is a comprehensive list of test scenarios for the `OrderCalculator` class, covering initialization, item management, calculations, and utility methods.\n\n### 1. Initialization (`__init__`)\n*   **Default Initialization (Normal Use):**\n    *   Verify that creating an instance without arguments sets the default values: tax rate (0.23), free shipping threshold (100.0), and shipping cost (10.0), and initializes an empty items list.\n*   **Custom Initialization (Normal Use):**\n    *   Verify that creating an instance with valid custom arguments correctly stores the provided tax rate, threshold, and shipping cost.\n*   **Invalid Tax Rate Type (TypeError):**\n    *   Verify `TypeError` is raised when `tax_rate` is not a float or int (e.g., a string).\n*   **Invalid Tax Rate Range (ValueError):**\n    *   Verify `ValueError` is raised when `tax_rate` is less than 0.0 or greater than 1.0.\n*   **Invalid Threshold/Shipping Cost Type (TypeError):**\n    *   Verify `TypeError` is raised when `free_shipping_threshold` or `shipping_cost` are not numbers.\n*   **Negative Threshold/Shipping Cost (ValueError):**\n    *   Verify `ValueError` is raised when `free_shipping_threshold` or `shipping_cost` are negative.\n\n### 2. Item Management (`add_item`)\n*   **Add New Item (Normal Use):**\n    *   Verify adding a new item correctly appends it to the `items` list with the specified name, price, and quantity.\n*   **Update Existing Item Quantity (Normal Use):**\n    *   Verify that adding an item with a name and price that already exists in the order increments the quantity of the existing entry instead of creating a duplicate.\n*   **Item Price Conflict (Exception):**\n    *   Verify `ValueError` is raised when adding an item with an existing name but a different price.\n*   **Invalid Item Name (ValueError):**\n    *   Verify `ValueError` is raised when the item name is an empty string.\n*   **Invalid Item Price (ValueError):**\n    *   Verify `ValueError` is raised when the price is less than or equal to 0.\n*   **Invalid Quantity (ValueError):**\n    *   Verify `ValueError` is raised when the quantity is less than 1.\n*   **Invalid Input Types (TypeError):**\n    *   Verify `TypeError` is raised if name is not a string, or price/quantity are not numbers.\n\n### 3. Item Management (`remove_item`)\n*   **Remove Existing Item (Normal Use):**\n    *   Verify that removing an item by name successfully deletes it from the `items` list.\n*   **Remove Non-Existent Item (Exception):**\n    *   Verify `ValueError` is raised when trying to remove an item name that is not in the order.\n*   **Invalid Name Type (TypeError):**\n    *   Verify `TypeError` is raised if the name argument is not a string.\n\n### 4. Subtotal Calculation (`get_subtotal`)\n*   **Calculate Subtotal (Normal Use):**\n    *   Verify the subtotal is correctly calculated as the sum of (price * quantity) for all items in the order.\n*   **Empty Order Subtotal (Exception):**\n    *   Verify `ValueError` is raised when attempting to calculate the subtotal of an empty order.\n\n### 5. Discount Application (`apply_discount`)\n*   **Apply Valid Discount (Normal Use):**\n    *   Verify the method returns the correctly reduced amount for a valid discount rate (e.g., 0.2).\n*   **Apply Zero/Full Discount (Edge Case):**\n    *   Verify behavior for 0.0 (no change) and 1.0 (free) discount rates.\n*   **Invalid Discount Range (ValueError):**\n    *   Verify `ValueError` is raised if the discount is less than 0.0 or greater than 1.0.\n*   **Negative Subtotal (ValueError):**\n    *   Verify `ValueError` is raised if the input subtotal is negative.\n*   **Invalid Types (TypeError):**\n    *   Verify `TypeError` is raised if inputs are not numbers.\n\n### 6. Shipping Calculation (`calculate_shipping`)\n*   **Below Threshold (Normal Use):**\n    *   Verify that the standard shipping cost is returned when the discounted subtotal is below the `free_shipping_threshold`.\n*   **Above Threshold (Normal Use):**\n    *   Verify that 0.0 is returned when the discounted subtotal is greater than the `free_shipping_threshold`.\n*   **Exact Threshold (Edge Case):**\n    *   Verify that 0.0 is returned when the discounted subtotal is exactly equal to the `free_shipping_threshold`.\n*   **Invalid Input (TypeError):**\n    *   Verify `TypeError` is raised if the input is not a number.\n\n### 7. Tax Calculation (`calculate_tax`)\n*   **Calculate Tax (Normal Use):**\n    *   Verify the tax is correctly calculated based on the configured `tax_rate`.\n*   **Negative Amount (ValueError):**\n    *   Verify `ValueError` is raised if the input amount is negative.\n*   **Invalid Input (TypeError):**\n    *   Verify `TypeError` is raised if the input is not a number.\n\n### 8. Total Calculation (`calculate_total`)\n*   **Standard Total with Shipping (Integration):**\n    *   Verify the full calculation flow: (Subtotal - Discount) + Shipping + Tax, where the order does *not* qualify for free shipping.\n*   **Total with Free Shipping (Integration):**\n    *   Verify the full calculation flow where the order *does* qualify for free shipping.\n*   **Discount Affecting Shipping (Edge Case):**\n    *   Verify a scenario where the raw subtotal qualifies for free shipping, but the applied discount reduces it below the threshold, triggering the shipping cost.\n*   **Empty Order (Exception):**\n    *   Verify `ValueError` is propagated from `get_subtotal` if `calculate_total` is called on an empty order.\n*   **Invalid Discount (TypeError):**\n    *   Verify `TypeError` is raised if the discount argument is not a number.\n\n### 9. Utility Methods (`total_items`, `clear_order`, `list_items`, `is_empty`)\n*   **Total Items Count:**\n    *   Verify `total_items` returns the sum of all item quantities, or 0 for an empty order.\n*   **Clear Order:**\n    *   Verify `clear_order` removes all items and `is_empty` subsequently returns `True`.\n*   **List Items:**\n    *   Verify `list_items` returns a list of names of the items currently in the order.\n*   **Is Empty Check:**\n    *   Verify `is_empty` returns `True` for a new/cleared order and `False` after adding items.",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.oc = OrderCalculator()\n\n    def test_init_defaults(self):\n        self.assertEqual(self.oc.tax_rate, 0.23)\n        self.assertEqual(self.oc.free_shipping_threshold, 100.0)\n        self.assertEqual(self.oc.shipping_cost, 10.0)\n        self.assertEqual(self.oc.items, [])\n\n    def test_init_custom_values(self):\n        oc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(oc.tax_rate, 0.1)\n        self.assertEqual(oc.free_shipping_threshold, 50.0)\n        self.assertEqual(oc.shipping_cost, 5.0)\n\n    def test_init_invalid_tax_type(self):\n        with self.assertRaises(TypeError):\n            OrderCalculator(tax_rate=\"0.23\")\n\n    def test_init_invalid_tax_rate_low(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n\n    def test_init_invalid_tax_rate_high(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=1.1)\n\n    def test_init_invalid_threshold_type(self):\n        with self.assertRaises(TypeError):\n            OrderCalculator(free_shipping_threshold=\"100\")\n\n    def test_init_negative_threshold(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(free_shipping_threshold=-1.0)\n\n    def test_init_invalid_shipping_cost_type(self):\n        with self.assertRaises(TypeError):\n            OrderCalculator(shipping_cost=\"10\")\n\n    def test_init_negative_shipping_cost(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-5.0)\n\n    def test_add_item_new(self):\n        self.oc.add_item(\"Apple\", 1.5, 10)\n        self.assertEqual(len(self.oc.items), 1)\n        self.assertEqual(self.oc.items[0], {\"name\": \"Apple\", \"price\": 1.5, \"quantity\": 10})\n\n    def test_add_item_update_quantity(self):\n        self.oc.add_item(\"Apple\", 1.5, 5)\n        self.oc.add_item(\"Apple\", 1.5, 3)\n        self.assertEqual(len(self.oc.items), 1)\n        self.assertEqual(self.oc.items[0][\"quantity\"], 8)\n\n    def test_add_item_price_conflict(self):\n        self.oc.add_item(\"Apple\", 1.5, 5)\n        with self.assertRaises(ValueError):\n            self.oc.add_item(\"Apple\", 2.0, 3)\n\n    def test_add_item_invalid_name_empty(self):\n        with self.assertRaises(ValueError):\n            self.oc.add_item(\"\", 10.0)\n\n    def test_add_item_invalid_price_zero(self):\n        with self.assertRaises(ValueError):\n            self.oc.add_item(\"Apple\", 0.0)\n\n    def test_add_item_invalid_quantity_low(self):\n        with self.assertRaises(ValueError):\n            self.oc.add_item(\"Apple\", 1.5, 0)\n\n    def test_add_item_invalid_name_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.add_item(123, 10.0)\n\n    def test_add_item_invalid_price_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.add_item(\"Apple\", \"10\")\n\n    def test_add_item_invalid_quantity_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.add_item(\"Apple\", 10.0, \"1\")\n\n    def test_remove_item_existing(self):\n        self.oc.add_item(\"Apple\", 1.5, 5)\n        self.oc.remove_item(\"Apple\")\n        self.assertEqual(len(self.oc.items), 0)\n\n    def test_remove_item_non_existent(self):\n        with self.assertRaises(ValueError):\n            self.oc.remove_item(\"Banana\")\n\n    def test_remove_item_invalid_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.remove_item(123)\n\n    def test_get_subtotal_calculation(self):\n        self.oc.add_item(\"Apple\", 2.0, 3)\n        self.oc.add_item(\"Banana\", 1.0, 5)\n        self.assertAlmostEqual(self.oc.get_subtotal(), 11.0)\n\n    def test_get_subtotal_empty_order(self):\n        with self.assertRaises(ValueError):\n            self.oc.get_subtotal()\n\n    def test_apply_discount_valid(self):\n        result = self.oc.apply_discount(100.0, 0.2)\n        self.assertAlmostEqual(result, 80.0)\n\n    def test_apply_discount_zero(self):\n        result = self.oc.apply_discount(100.0, 0.0)\n        self.assertAlmostEqual(result, 100.0)\n\n    def test_apply_discount_full(self):\n        result = self.oc.apply_discount(100.0, 1.0)\n        self.assertAlmostEqual(result, 0.0)\n\n    def test_apply_discount_invalid_range_high(self):\n        with self.assertRaises(ValueError):\n            self.oc.apply_discount(100.0, 1.5)\n\n    def test_apply_discount_invalid_range_low(self):\n        with self.assertRaises(ValueError):\n            self.oc.apply_discount(100.0, -0.1)\n\n    def test_apply_discount_negative_subtotal(self):\n        with self.assertRaises(ValueError):\n            self.oc.apply_discount(-10.0, 0.2)\n\n    def test_apply_discount_invalid_types(self):\n        with self.assertRaises(TypeError):\n            self.oc.apply_discount(\"100\", 0.2)\n\n    def test_calculate_shipping_below_threshold(self):\n        cost = self.oc.calculate_shipping(50.0)\n        self.assertEqual(cost, 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        cost = self.oc.calculate_shipping(150.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_shipping_exact_threshold(self):\n        cost = self.oc.calculate_shipping(100.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_shipping_invalid_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.calculate_shipping(\"50\")\n\n    def test_calculate_tax_normal(self):\n        tax = self.oc.calculate_tax(100.0)\n        self.assertAlmostEqual(tax, 23.0)\n\n    def test_calculate_tax_negative_amount(self):\n        with self.assertRaises(ValueError):\n            self.oc.calculate_tax(-10.0)\n\n    def test_calculate_tax_invalid_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.calculate_tax(\"100\")\n\n    def test_calculate_total_standard_with_shipping(self):\n        self.oc.add_item(\"Item1\", 50.0, 1)\n        total = self.oc.calculate_total()\n        self.assertAlmostEqual(total, 73.8)\n\n    def test_calculate_total_free_shipping(self):\n        self.oc.add_item(\"Item1\", 200.0, 1)\n        total = self.oc.calculate_total()\n        self.assertAlmostEqual(total, 246.0)\n\n    def test_calculate_total_discount_triggers_shipping(self):\n        self.oc.add_item(\"Item1\", 110.0, 1)\n        total = self.oc.calculate_total(discount=0.1)\n        expected_subtotal = 99.0\n        expected_shipping = 10.0\n        expected_tax = (99.0 + 10.0) * 0.23\n        self.assertAlmostEqual(total, expected_subtotal + expected_shipping + expected_tax)\n\n    def test_calculate_total_empty_order(self):\n        with self.assertRaises(ValueError):\n            self.oc.calculate_total()\n\n    def test_calculate_total_invalid_discount_type(self):\n        self.oc.add_item(\"Item\", 10.0, 1)\n        with self.assertRaises(TypeError):\n            self.oc.calculate_total(discount=\"0.2\")\n\n    def test_total_items(self):\n        self.oc.add_item(\"A\", 10.0, 2)\n        self.oc.add_item(\"B\", 5.0, 3)\n        self.assertEqual(self.oc.total_items(), 5)\n\n    def test_total_items_empty(self):\n        self.assertEqual(self.oc.total_items(), 0)\n\n    def test_clear_order(self):\n        self.oc.add_item(\"A\", 10.0, 1)\n        self.oc.clear_order()\n        self.assertEqual(len(self.oc.items), 0)\n        self.assertTrue(self.oc.is_empty())\n\n    def test_list_items(self):\n        self.oc.add_item(\"A\", 10.0, 1)\n        self.oc.add_item(\"B\", 5.0, 1)\n        items = self.oc.list_items()\n        self.assertEqual(set(items), {\"A\", \"B\"})\n\n    def test_is_empty_true(self):\n        self.assertTrue(self.oc.is_empty())\n\n    def test_is_empty_false(self):\n        self.oc.add_item(\"A\", 10.0, 1)\n        self.assertFalse(self.oc.is_empty())\n\nif __name__ == '__main__':\n    unittest.main()\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.oc = OrderCalculator()\n\n    def test_init_defaults(self):\n        self.assertEqual(self.oc.tax_rate, 0.23)\n        self.assertEqual(self.oc.free_shipping_threshold, 100.0)\n        self.assertEqual(self.oc.shipping_cost, 10.0)\n        self.assertEqual(self.oc.items, [])\n\n    def test_init_custom_values(self):\n        oc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(oc.tax_rate, 0.1)\n        self.assertEqual(oc.free_shipping_threshold, 50.0)\n        self.assertEqual(oc.shipping_cost, 5.0)\n\n    def test_init_invalid_tax_type(self):\n        with self.assertRaises(TypeError):\n            OrderCalculator(tax_rate=\"0.23\")\n\n    def test_init_invalid_tax_rate_low(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n\n    def test_init_invalid_tax_rate_high(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=1.1)\n\n    def test_init_invalid_threshold_type(self):\n        with self.assertRaises(TypeError):\n            OrderCalculator(free_shipping_threshold=\"100\")\n\n    def test_init_negative_threshold(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(free_shipping_threshold=-1.0)\n\n    def test_init_invalid_shipping_cost_type(self):\n        with self.assertRaises(TypeError):\n            OrderCalculator(shipping_cost=\"10\")\n\n    def test_init_negative_shipping_cost(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-5.0)\n\n    def test_add_item_new(self):\n        self.oc.add_item(\"Apple\", 1.5, 10)\n        self.assertEqual(len(self.oc.items), 1)\n        self.assertEqual(self.oc.items[0], {\"name\": \"Apple\", \"price\": 1.5, \"quantity\": 10})\n\n    def test_add_item_update_quantity(self):\n        self.oc.add_item(\"Apple\", 1.5, 5)\n        self.oc.add_item(\"Apple\", 1.5, 3)\n        self.assertEqual(len(self.oc.items), 1)\n        self.assertEqual(self.oc.items[0][\"quantity\"], 8)\n\n    def test_add_item_price_conflict(self):\n        self.oc.add_item(\"Apple\", 1.5, 5)\n        with self.assertRaises(ValueError):\n            self.oc.add_item(\"Apple\", 2.0, 3)\n\n    def test_add_item_invalid_name_empty(self):\n        with self.assertRaises(ValueError):\n            self.oc.add_item(\"\", 10.0)\n\n    def test_add_item_invalid_price_zero(self):\n        with self.assertRaises(ValueError):\n            self.oc.add_item(\"Apple\", 0.0)\n\n    def test_add_item_invalid_quantity_low(self):\n        with self.assertRaises(ValueError):\n            self.oc.add_item(\"Apple\", 1.5, 0)\n\n    def test_add_item_invalid_name_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.add_item(123, 10.0)\n\n    def test_add_item_invalid_price_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.add_item(\"Apple\", \"10\")\n\n    def test_add_item_invalid_quantity_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.add_item(\"Apple\", 10.0, \"1\")\n\n    def test_remove_item_existing(self):\n        self.oc.add_item(\"Apple\", 1.5, 5)\n        self.oc.remove_item(\"Apple\")\n        self.assertEqual(len(self.oc.items), 0)\n\n    def test_remove_item_non_existent(self):\n        with self.assertRaises(ValueError):\n            self.oc.remove_item(\"Banana\")\n\n    def test_remove_item_invalid_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.remove_item(123)\n\n    def test_get_subtotal_calculation(self):\n        self.oc.add_item(\"Apple\", 2.0, 3)\n        self.oc.add_item(\"Banana\", 1.0, 5)\n        self.assertAlmostEqual(self.oc.get_subtotal(), 11.0)\n\n    def test_get_subtotal_empty_order(self):\n        with self.assertRaises(ValueError):\n            self.oc.get_subtotal()\n\n    def test_apply_discount_valid(self):\n        result = self.oc.apply_discount(100.0, 0.2)\n        self.assertAlmostEqual(result, 80.0)\n\n    def test_apply_discount_zero(self):\n        result = self.oc.apply_discount(100.0, 0.0)\n        self.assertAlmostEqual(result, 100.0)\n\n    def test_apply_discount_full(self):\n        result = self.oc.apply_discount(100.0, 1.0)\n        self.assertAlmostEqual(result, 0.0)\n\n    def test_apply_discount_invalid_range_high(self):\n        with self.assertRaises(ValueError):\n            self.oc.apply_discount(100.0, 1.5)\n\n    def test_apply_discount_invalid_range_low(self):\n        with self.assertRaises(ValueError):\n            self.oc.apply_discount(100.0, -0.1)\n\n    def test_apply_discount_negative_subtotal(self):\n        with self.assertRaises(ValueError):\n            self.oc.apply_discount(-10.0, 0.2)\n\n    def test_apply_discount_invalid_types(self):\n        with self.assertRaises(TypeError):\n            self.oc.apply_discount(\"100\", 0.2)\n\n    def test_calculate_shipping_below_threshold(self):\n        cost = self.oc.calculate_shipping(50.0)\n        self.assertEqual(cost, 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        cost = self.oc.calculate_shipping(150.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_shipping_exact_threshold(self):\n        cost = self.oc.calculate_shipping(100.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_shipping_invalid_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.calculate_shipping(\"50\")\n\n    def test_calculate_tax_normal(self):\n        tax = self.oc.calculate_tax(100.0)\n        self.assertAlmostEqual(tax, 23.0)\n\n    def test_calculate_tax_negative_amount(self):\n        with self.assertRaises(ValueError):\n            self.oc.calculate_tax(-10.0)\n\n    def test_calculate_tax_invalid_type(self):\n        with self.assertRaises(TypeError):\n            self.oc.calculate_tax(\"100\")\n\n    def test_calculate_total_standard_with_shipping(self):\n        self.oc.add_item(\"Item1\", 50.0, 1)\n        total = self.oc.calculate_total()\n        self.assertAlmostEqual(total, 73.8)\n\n    def test_calculate_total_free_shipping(self):\n        self.oc.add_item(\"Item1\", 200.0, 1)\n        total = self.oc.calculate_total()\n        self.assertAlmostEqual(total, 246.0)\n\n    def test_calculate_total_discount_triggers_shipping(self):\n        self.oc.add_item(\"Item1\", 110.0, 1)\n        total = self.oc.calculate_total(discount=0.1)\n        expected_subtotal = 99.0\n        expected_shipping = 10.0\n        expected_tax = (99.0 + 10.0) * 0.23\n        self.assertAlmostEqual(total, expected_subtotal + expected_shipping + expected_tax)\n\n    def test_calculate_total_empty_order(self):\n        with self.assertRaises(ValueError):\n            self.oc.calculate_total()\n\n    def test_calculate_total_invalid_discount_type(self):\n        self.oc.add_item(\"Item\", 10.0, 1)\n        with self.assertRaises(TypeError):\n            self.oc.calculate_total(discount=\"0.2\")\n\n    def test_total_items(self):\n        self.oc.add_item(\"A\", 10.0, 2)\n        self.oc.add_item(\"B\", 5.0, 3)\n        self.assertEqual(self.oc.total_items(), 5)\n\n    def test_total_items_empty(self):\n        self.assertEqual(self.oc.total_items(), 0)\n\n    def test_clear_order(self):\n        self.oc.add_item(\"A\", 10.0, 1)\n        self.oc.clear_order()\n        self.assertEqual(len(self.oc.items), 0)\n        self.assertTrue(self.oc.is_empty())\n\n    def test_list_items(self):\n        self.oc.add_item(\"A\", 10.0, 1)\n        self.oc.add_item(\"B\", 5.0, 1)\n        items = self.oc.list_items()\n        self.assertEqual(set(items), {\"A\", \"B\"})\n\n    def test_is_empty_true(self):\n        self.assertTrue(self.oc.is_empty())\n\n    def test_is_empty_false(self):\n        self.oc.add_item(\"A\", 10.0, 1)\n        self.assertFalse(self.oc.is_empty())\n\nif __name__ == '__main__':\n    unittest.main()\n```",
    "total_response_time": 156.13351106643677,
    "strategy": "chain_of_thought_prompting",
    "context_type": "full_context"
  }
}