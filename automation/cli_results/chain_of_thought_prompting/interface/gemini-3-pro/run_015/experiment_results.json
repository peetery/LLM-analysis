{
  "model": "gemini-3-pro",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2025-12-30T19:15:52.851611",
  "response_time": 119.17351293563843,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-pro\\run_015\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I have analyzed the provided `OrderCalculator` class interface.\n\n**Class Analysis:**\n\n*   **State Management:** The class manages a shopping cart state (items, their prices, and quantities) and configuration settings (tax rate, shipping threshold, shipping cost).\n*   **Core Logic:** It performs financial calculations involving subtotals, discounts, shipping fees based on thresholds, and tax calculations.\n*   **Item Management:** It supports adding, removing, listing, and clearing items.\n*   **Edge Cases to Consider:**\n    *   Empty orders (affecting subtotal, lists, boolean checks).\n    *   Shipping threshold boundaries (exact match vs. just over/under).\n    *   Discount logic (ensuring total doesn't go negative, if applicable).\n    *   Invalid inputs for prices or quantities (negative numbers).\n    *   Floating point precision issues (typical in financial calculations, though standard `unittest` usually handles equality with `assertAlmostEqual`).\n\nI am prepared to generate the test scenarios and code in the next step. Please proceed with your instructions.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Here is a comprehensive list of unit test scenarios for the `OrderCalculator` class:\n\n### 1. Initialization (`__init__`)\n*   **Normal Use:** Verify that the calculator initializes with default values for tax rate (`0.23`), free shipping threshold (`100.0`), and shipping cost (`10.0`).\n*   **Normal Use:** Verify that the calculator initializes correctly when custom values are provided for all parameters.\n\n### 2. Adding Items (`add_item`)\n*   **Normal Use:** Add a single new item and verify it is stored correctly.\n*   **Normal Use:** Add the same item twice (same name) to verify that the quantity updates correctly (increments) rather than creating a duplicate entry.\n*   **Normal Use:** Add multiple different items and verify all are present.\n*   **Invalid Input:** Attempt to add an item with a negative price (should likely raise `ValueError`).\n*   **Invalid Input:** Attempt to add an item with zero or negative quantity (should likely raise `ValueError`).\n*   **Invalid Input:** Attempt to add an item with an empty string as the name (should likely raise `ValueError`).\n\n### 3. Removing Items (`remove_item`)\n*   **Normal Use:** Remove an existing item from the order and verify it is no longer in the list.\n*   **Edge Case:** Attempt to remove an item that does not exist in the order (should handle gracefully, e.g., do nothing, or raise a specific error like `KeyError` or `ValueError`).\n*   **State Check:** Verify that removing the last item makes the order empty.\n\n### 4. Subtotal Calculation (`get_subtotal`)\n*   **Normal Use:** Calculate subtotal for an order with multiple items (sum of `price * quantity` for all items).\n*   **Edge Case:** Calculate subtotal for an empty order (should be `0.0`).\n*   **Edge Case:** Calculate subtotal for items with floating-point prices to ensure precision (e.g., `10.1` + `20.2`).\n\n### 5. Discount Application (`apply_discount`)\n*   **Normal Use:** Apply a valid discount (e.g., `10.0` off a `100.0` subtotal) and verify the result.\n*   **Edge Case:** Apply a discount equal to the subtotal (result should be `0.0`).\n*   **Edge Case:** Apply a discount greater than the subtotal (result should be `0.0`, ensuring total doesn't go negative).\n*   **Invalid Input:** Apply a negative discount (should raise `ValueError`).\n\n### 6. Shipping Calculation (`calculate_shipping`)\n*   **Normal Use (Below Threshold):** Calculate shipping when `discounted_subtotal` is below the free shipping threshold (should return `shipping_cost`).\n*   **Normal Use (Above Threshold):** Calculate shipping when `discounted_subtotal` is above the free shipping threshold (should return `0.0`).\n*   **Edge Case (Exact Threshold):** Calculate shipping when `discounted_subtotal` equals the free shipping threshold exactly (typically free, verifying boundary condition).\n*   **State Interaction:** Verify shipping is calculated based on the *discounted* price, not the original subtotal (if applicable logic dictates).\n\n### 7. Tax Calculation (`calculate_tax`)\n*   **Normal Use:** Calculate tax on a standard amount (amount * tax_rate).\n*   **Edge Case:** Calculate tax on `0.0` amount (should be `0.0`).\n\n### 8. Total Calculation (`calculate_total`)\n*   **Normal Use (Full Flow):** Calculate total for a standard order: `(subtotal - discount) + shipping + tax`.\n*   **Edge Case (Free Shipping):** Calculate total where the amount triggers free shipping.\n*   **Edge Case (Full Discount):** Calculate total where discount covers the entire subtotal (total should essentially be just shipping cost? or 0? Needs to verify business logic).\n*   **Integration:** Ensure tax is calculated on the correct base (e.g., usually `subtotal - discount + shipping` or `subtotal - discount`, dependent on locale/logic). This test validates the order of operations.\n\n### 9. Item Counting (`total_items`)\n*   **Normal Use:** Count items in an order with multiple unique items.\n*   **Normal Use:** Count items where some have a quantity > 1 (e.g., 2 apples + 1 banana = 3 total items).\n*   **Edge Case:** Count items in an empty order (should be `0`).\n\n### 10. Listing Items (`list_items`)\n*   **Normal Use:** List items for a populated order (verify returns a list of strings).\n*   **Edge Case:** List items for an empty order (should return an empty list).\n\n### 11. Order Status (`is_empty`)\n*   **Normal Use:** Check `is_empty` on a new/cleared order (should be `True`).\n*   **Normal Use:** Check `is_empty` after adding an item (should be `False`).\n\n### 12. Clearing Order (`clear_order`)\n*   **Normal Use:** Clear a populated order and verify `is_empty` is True and `total_items` is 0.\n*   **Edge Case:** Call `clear_order` on an already empty order (should not error).",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n    def setUp(self):\n        self.calc = OrderCalculator()\n\n    def test_init_default_values(self):\n        calculator = OrderCalculator()\n        self.assertTrue(calculator.is_empty())\n        self.assertEqual(calculator.total_items(), 0)\n\n    def test_init_custom_values(self):\n        calculator = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertTrue(calculator.is_empty())\n\n    def test_add_item_new(self):\n        self.calc.add_item(\"Apple\", 1.5, 2)\n        self.assertEqual(self.calc.total_items(), 2)\n        self.assertFalse(self.calc.is_empty())\n\n    def test_add_item_update_quantity(self):\n        self.calc.add_item(\"Apple\", 1.5, 2)\n        self.calc.add_item(\"Apple\", 1.5, 3)\n        self.assertEqual(self.calc.total_items(), 5)\n\n    def test_add_item_multiple_different(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.add_item(\"Banana\", 2.0, 1)\n        self.assertEqual(self.calc.total_items(), 2)\n        self.assertEqual(self.calc.get_subtotal(), 3.0)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadItem\", -10.0, 1)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadItem\", 10.0, 0)\n\n    def test_add_item_empty_name(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"\", 10.0, 1)\n\n    def test_remove_existing_item(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.remove_item(\"Apple\")\n        self.assertTrue(self.calc.is_empty())\n\n    def test_remove_non_existent_item(self):\n        with self.assertRaises(KeyError):\n            self.calc.remove_item(\"Ghost\")\n\n    def test_remove_last_item_clears_state(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.remove_item(\"Apple\")\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_get_subtotal_mixed_items(self):\n        self.calc.add_item(\"Item1\", 10.0, 2)\n        self.calc.add_item(\"Item2\", 5.0, 1)\n        self.assertEqual(self.calc.get_subtotal(), 25.0)\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_get_subtotal_floats(self):\n        self.calc.add_item(\"Item1\", 10.1, 1)\n        self.calc.add_item(\"Item2\", 20.2, 1)\n        self.assertAlmostEqual(self.calc.get_subtotal(), 30.3)\n\n    def test_apply_discount_valid(self):\n        result = self.calc.apply_discount(100.0, 10.0)\n        self.assertEqual(result, 90.0)\n\n    def test_apply_discount_equals_subtotal(self):\n        result = self.calc.apply_discount(100.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_exceeds_subtotal(self):\n        result = self.calc.apply_discount(100.0, 150.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calc.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        cost = self.calc.calculate_shipping(50.0)\n        self.assertEqual(cost, 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        cost = self.calc.calculate_shipping(150.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_shipping_exact_threshold(self):\n        cost = self.calc.calculate_shipping(100.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_tax_standard(self):\n        tax = self.calc.calculate_tax(100.0)\n        self.assertAlmostEqual(tax, 23.0)\n\n    def test_calculate_tax_zero(self):\n        tax = self.calc.calculate_tax(0.0)\n        self.assertEqual(tax, 0.0)\n\n    def test_calculate_total_standard(self):\n        self.calc.add_item(\"Item\", 50.0, 1)\n        total = self.calc.calculate_total(discount=0.0)\n        expected_tax = 50.0 * 0.23\n        expected_shipping = 10.0\n        self.assertAlmostEqual(total, 50.0 + expected_tax + expected_shipping)\n\n    def test_calculate_total_free_shipping(self):\n        self.calc.add_item(\"Item\", 200.0, 1)\n        total = self.calc.calculate_total(discount=0.0)\n        expected_tax = 200.0 * 0.23\n        self.assertAlmostEqual(total, 200.0 + expected_tax)\n\n    def test_calculate_total_full_discount(self):\n        self.calc.add_item(\"Item\", 50.0, 1)\n        total = self.calc.calculate_total(discount=50.0)\n        self.assertEqual(total, 10.0)\n\n    def test_total_items_mixed(self):\n        self.calc.add_item(\"A\", 10, 1)\n        self.calc.add_item(\"B\", 10, 2)\n        self.assertEqual(self.calc.total_items(), 3)\n\n    def test_total_items_empty(self):\n        self.assertEqual(self.calc.total_items(), 0)\n\n    def test_list_items_populated(self):\n        self.calc.add_item(\"A\", 10, 1)\n        self.calc.add_item(\"B\", 10, 1)\n        items = self.calc.list_items()\n        self.assertIn(\"A\", items)\n        self.assertIn(\"B\", items)\n        self.assertEqual(len(items), 2)\n\n    def test_list_items_empty(self):\n        self.assertEqual(self.calc.list_items(), [])\n\n    def test_is_empty_true(self):\n        self.assertTrue(self.calc.is_empty())\n\n    def test_is_empty_false(self):\n        self.calc.add_item(\"A\", 1, 1)\n        self.assertFalse(self.calc.is_empty())\n\n    def test_clear_order(self):\n        self.calc.add_item(\"A\", 1, 1)\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_clear_already_empty(self):\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n    def setUp(self):\n        self.calc = OrderCalculator()\n\n    def test_init_default_values(self):\n        calculator = OrderCalculator()\n        self.assertTrue(calculator.is_empty())\n        self.assertEqual(calculator.total_items(), 0)\n\n    def test_init_custom_values(self):\n        calculator = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertTrue(calculator.is_empty())\n\n    def test_add_item_new(self):\n        self.calc.add_item(\"Apple\", 1.5, 2)\n        self.assertEqual(self.calc.total_items(), 2)\n        self.assertFalse(self.calc.is_empty())\n\n    def test_add_item_update_quantity(self):\n        self.calc.add_item(\"Apple\", 1.5, 2)\n        self.calc.add_item(\"Apple\", 1.5, 3)\n        self.assertEqual(self.calc.total_items(), 5)\n\n    def test_add_item_multiple_different(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.add_item(\"Banana\", 2.0, 1)\n        self.assertEqual(self.calc.total_items(), 2)\n        self.assertEqual(self.calc.get_subtotal(), 3.0)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadItem\", -10.0, 1)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadItem\", 10.0, 0)\n\n    def test_add_item_empty_name(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"\", 10.0, 1)\n\n    def test_remove_existing_item(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.remove_item(\"Apple\")\n        self.assertTrue(self.calc.is_empty())\n\n    def test_remove_non_existent_item(self):\n        with self.assertRaises(KeyError):\n            self.calc.remove_item(\"Ghost\")\n\n    def test_remove_last_item_clears_state(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.remove_item(\"Apple\")\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_get_subtotal_mixed_items(self):\n        self.calc.add_item(\"Item1\", 10.0, 2)\n        self.calc.add_item(\"Item2\", 5.0, 1)\n        self.assertEqual(self.calc.get_subtotal(), 25.0)\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_get_subtotal_floats(self):\n        self.calc.add_item(\"Item1\", 10.1, 1)\n        self.calc.add_item(\"Item2\", 20.2, 1)\n        self.assertAlmostEqual(self.calc.get_subtotal(), 30.3)\n\n    def test_apply_discount_valid(self):\n        result = self.calc.apply_discount(100.0, 10.0)\n        self.assertEqual(result, 90.0)\n\n    def test_apply_discount_equals_subtotal(self):\n        result = self.calc.apply_discount(100.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_exceeds_subtotal(self):\n        result = self.calc.apply_discount(100.0, 150.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calc.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        cost = self.calc.calculate_shipping(50.0)\n        self.assertEqual(cost, 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        cost = self.calc.calculate_shipping(150.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_shipping_exact_threshold(self):\n        cost = self.calc.calculate_shipping(100.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_tax_standard(self):\n        tax = self.calc.calculate_tax(100.0)\n        self.assertAlmostEqual(tax, 23.0)\n\n    def test_calculate_tax_zero(self):\n        tax = self.calc.calculate_tax(0.0)\n        self.assertEqual(tax, 0.0)\n\n    def test_calculate_total_standard(self):\n        self.calc.add_item(\"Item\", 50.0, 1)\n        total = self.calc.calculate_total(discount=0.0)\n        expected_tax = 50.0 * 0.23\n        expected_shipping = 10.0\n        self.assertAlmostEqual(total, 50.0 + expected_tax + expected_shipping)\n\n    def test_calculate_total_free_shipping(self):\n        self.calc.add_item(\"Item\", 200.0, 1)\n        total = self.calc.calculate_total(discount=0.0)\n        expected_tax = 200.0 * 0.23\n        self.assertAlmostEqual(total, 200.0 + expected_tax)\n\n    def test_calculate_total_full_discount(self):\n        self.calc.add_item(\"Item\", 50.0, 1)\n        total = self.calc.calculate_total(discount=50.0)\n        self.assertEqual(total, 10.0)\n\n    def test_total_items_mixed(self):\n        self.calc.add_item(\"A\", 10, 1)\n        self.calc.add_item(\"B\", 10, 2)\n        self.assertEqual(self.calc.total_items(), 3)\n\n    def test_total_items_empty(self):\n        self.assertEqual(self.calc.total_items(), 0)\n\n    def test_list_items_populated(self):\n        self.calc.add_item(\"A\", 10, 1)\n        self.calc.add_item(\"B\", 10, 1)\n        items = self.calc.list_items()\n        self.assertIn(\"A\", items)\n        self.assertIn(\"B\", items)\n        self.assertEqual(len(items), 2)\n\n    def test_list_items_empty(self):\n        self.assertEqual(self.calc.list_items(), [])\n\n    def test_is_empty_true(self):\n        self.assertTrue(self.calc.is_empty())\n\n    def test_is_empty_false(self):\n        self.calc.add_item(\"A\", 1, 1)\n        self.assertFalse(self.calc.is_empty())\n\n    def test_clear_order(self):\n        self.calc.add_item(\"A\", 1, 1)\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_clear_already_empty(self):\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n```",
    "total_response_time": 119.17351293563843,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}