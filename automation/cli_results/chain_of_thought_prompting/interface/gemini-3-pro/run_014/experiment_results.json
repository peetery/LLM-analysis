{
  "model": "gemini-3-pro",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2025-12-30T19:02:05.025137",
  "response_time": 108.78660488128662,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-pro\\run_014\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I have analyzed the provided `OrderCalculator` class interface.\n\n**Analysis Summary:**\n\n1.  **State Management:** The class manages an internal state of items (likely a list or dictionary) and configuration parameters (`tax_rate`, `free_shipping_threshold`, `shipping_cost`).\n2.  **Core Functionality:**\n    *   **Item Handling:** Methods to add, remove, list, and clear items (`add_item`, `remove_item`, `list_items`, `clear_order`).\n    *   **Financial Calculations:** Methods to compute costs at various stages (`get_subtotal`, `apply_discount`, `calculate_shipping`, `calculate_tax`, `calculate_total`).\n    *   **Utility/Query:** Helper methods to check state (`total_items`, `is_empty`).\n3.  **Key Logic Points & Edge Cases identified for future testing:**\n    *   **Initialization:** Default values vs. custom positive/negative values.\n    *   **Adding Items:** Handling duplicates (stacking quantity vs. overwriting), negative prices, or zero quantities.\n    *   **Removing Items:** Handling non-existent items.\n    *   **Discounts:** Logic for discounts exceeding the subtotal (negative total?).\n    *   **Shipping:** Boundary testing around the `free_shipping_threshold`.\n    *   **Total Calculation:** Order of operations (Subtotal -> Discount -> Shipping -> Tax) and ensuring the math is correct.\n    *   **Empty State:** Behavior of calculation methods when the order is empty.\n\nI am prepared to generate the specific test scenarios or test code upon your next command.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Here are the relevant unit test scenarios for the `OrderCalculator` class, categorized by method and test type.\n\n### **1. Initialization (`__init__`)**\n*   **`test_init_defaults`** (Normal Use): Verify that the calculator initializes with the default values for tax rate (0.23), free shipping threshold (100.0), and shipping cost (10.0), and an empty item list.\n*   **`test_init_custom_values`** (Normal Use): Verify that the calculator initializes correctly when custom values are provided for all arguments.\n*   **`test_init_negative_values`** (Invalid Input): Check behavior (or potential exceptions) if negative values are passed for tax rate or shipping costs, ensuring the system handles or rejects them gracefully.\n\n### **2. Adding Items (`add_item`)**\n*   **`test_add_item_single`** (Normal Use): Add a single valid item and verify the order is no longer empty and the item count increases.\n*   **`test_add_item_multiple_distinct`** (Normal Use): Add multiple different items and ensure all are stored correctly.\n*   **`test_add_item_increment_quantity`** (Normal Use): Add an item with the same name twice and verify that the quantity updates (sums up) rather than creating a duplicate entry.\n*   **`test_add_item_invalid_price`** (Invalid Input/Exception): Attempt to add an item with a negative price; expect a `ValueError`.\n*   **`test_add_item_invalid_quantity`** (Invalid Input/Exception): Attempt to add an item with a zero or negative quantity; expect a `ValueError`.\n*   **`test_add_item_empty_name`** (Invalid Input/Exception): Attempt to add an item with an empty string as a name; expect a `ValueError`.\n\n### **3. Removing Items (`remove_item`)**\n*   **`test_remove_existing_item`** (Normal Use): Remove an item that exists in the order and verify it is gone.\n*   **`test_remove_non_existent_item`** (Exception/Edge Case): Attempt to remove an item that is not in the list; expect a `KeyError` or a handled failure depending on implementation design.\n\n### **4. Subtotal Calculation (`get_subtotal`)**\n*   **`test_subtotal_empty`** (Edge Case): Verify subtotal is 0.0 when the order is empty.\n*   **`test_subtotal_calculation`** (Normal Use): specific items and verify the sum is exactly `price * quantity` for all items.\n*   **`test_subtotal_float_precision`** (Edge Case): Add items with prices requiring floating-point precision (e.g., 10.1 + 20.2) to ensure no rounding errors occur.\n\n### **5. Applying Discount (`apply_discount`)**\n*   **`test_apply_discount_valid`** (Normal Use): Apply a valid discount (e.g., 10.0 or 0.1 depending on if it's absolute or percentage) and verify the return value is reduced correctly.\n*   **`test_apply_discount_zero`** (Normal Use): Apply a 0 discount and ensure the value remains unchanged.\n*   **`test_apply_discount_exceeds_subtotal`** (Edge Case): Apply a discount larger than the subtotal; ensure the result is not negative (should likely floor at 0).\n*   **`test_apply_discount_negative`** (Invalid Input): Attempt to apply a negative discount; expect a `ValueError`.\n\n### **6. Shipping Calculation (`calculate_shipping`)**\n*   **`test_shipping_below_threshold`** (Normal Use): Pass a subtotal below the `free_shipping_threshold` and verify standard `shipping_cost` is returned.\n*   **`test_shipping_above_threshold`** (Normal Use): Pass a subtotal above the `free_shipping_threshold` and verify shipping is 0.0.\n*   **`test_shipping_exact_threshold`** (Boundary Case): Pass a subtotal exactly equal to the threshold; verify whether shipping is charged (usually free at inclusive threshold).\n\n### **7. Tax Calculation (`calculate_tax`)**\n*   **`test_calculate_tax_standard`** (Normal Use): Calculate tax on a standard amount using the configured `tax_rate`.\n*   **`test_calculate_tax_zero`** (Edge Case): Calculate tax on 0.0; result should be 0.0.\n\n### **8. Total Calculation (`calculate_total`)**\n*   **`test_calculate_total_standard_flow`** (Normal Use): Add items, provide a discount, and verify the final total includes: `(Subtotal - Discount) + Shipping + Tax`.\n*   **`test_calculate_total_free_shipping`** (Normal Use): Ensure the total reflects 0 shipping cost when the threshold is met.\n*   **`test_calculate_total_empty_order`** (Edge Case): Verify total is 0.0 (or just shipping cost? likely 0) for an empty order.\n\n### **9. Utility Methods (`total_items`, `list_items`, `is_empty`, `clear_order`)**\n*   **`test_total_items_sum_quantities`** (Normal Use): Verify this returns the sum of all item quantities, not just the count of unique keys.\n*   **`test_list_items_format`** (Normal Use): specific items and verify the output list contains the expected string representations (e.g., \"Name: $Price x Qty\").\n*   **`test_is_empty_initial`** (Normal Use): Verify returns `True` on new instance.\n*   **`test_is_empty_after_add`** (Normal Use): Verify returns `False` after adding items.\n*   **`test_clear_order`** (Normal Use): Add items, call clear, then verify `is_empty` is True, `total_items` is 0, and `get_subtotal` is 0.0.",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_defaults(self):\n        self.assertEqual(self.calculator.tax_rate, 0.23)\n        self.assertEqual(self.calculator.free_shipping_threshold, 100.0)\n        self.assertEqual(self.calculator.shipping_cost, 10.0)\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.10, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.tax_rate, 0.10)\n        self.assertEqual(calc.free_shipping_threshold, 50.0)\n        self.assertEqual(calc.shipping_cost, 5.0)\n\n    def test_init_negative_values(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-5.0)\n\n    def test_add_item_single(self):\n        self.calculator.add_item(\"Apple\", 1.5, 2)\n        self.assertEqual(self.calculator.total_items(), 2)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_add_item_multiple_distinct(self):\n        self.calculator.add_item(\"Apple\", 1.5, 1)\n        self.calculator.add_item(\"Banana\", 0.5, 1)\n        self.assertEqual(self.calculator.total_items(), 2)\n        items = self.calculator.list_items()\n        self.assertEqual(len(items), 2)\n\n    def test_add_item_increment_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.add_item(\"Apple\", 1.0, 2)\n        self.assertEqual(self.calculator.total_items(), 3)\n        self.assertAlmostEqual(self.calculator.get_subtotal(), 3.0)\n\n    def test_add_item_invalid_price(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"BadPrice\", -1.0, 1)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"BadQty\", 1.0, 0)\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"BadQty\", 1.0, -1)\n\n    def test_add_item_empty_name(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"\", 1.0, 1)\n\n    def test_remove_existing_item(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_non_existent_item(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"Ghost\")\n\n    def test_subtotal_empty(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_subtotal_calculation(self):\n        self.calculator.add_item(\"Item1\", 10.0, 2)\n        self.calculator.add_item(\"Item2\", 5.0, 3) \n        self.assertAlmostEqual(self.calculator.get_subtotal(), 35.0)\n\n    def test_subtotal_float_precision(self):\n        self.calculator.add_item(\"A\", 10.1, 1)\n        self.calculator.add_item(\"B\", 20.2, 1)\n        self.assertAlmostEqual(self.calculator.get_subtotal(), 30.3)\n\n    def test_apply_discount_valid(self):\n        subtotal = 100.0\n        discount = 10.0\n        result = self.calculator.apply_discount(subtotal, discount)\n        self.assertAlmostEqual(result, 90.0)\n\n    def test_apply_discount_zero(self):\n        subtotal = 50.0\n        result = self.calculator.apply_discount(subtotal, 0.0)\n        self.assertAlmostEqual(result, 50.0)\n\n    def test_apply_discount_exceeds_subtotal(self):\n        subtotal = 50.0\n        discount = 60.0\n        result = self.calculator.apply_discount(subtotal, discount)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_shipping_below_threshold(self):\n        subtotal = 50.0 \n        shipping = self.calculator.calculate_shipping(subtotal)\n        self.assertEqual(shipping, 10.0)\n\n    def test_shipping_above_threshold(self):\n        subtotal = 150.0\n        shipping = self.calculator.calculate_shipping(subtotal)\n        self.assertEqual(shipping, 0.0)\n\n    def test_shipping_exact_threshold(self):\n        subtotal = 100.0\n        shipping = self.calculator.calculate_shipping(subtotal)\n        self.assertEqual(shipping, 0.0)\n\n    def test_calculate_tax_standard(self):\n        amount = 100.0\n        tax = self.calculator.calculate_tax(amount)\n        self.assertAlmostEqual(tax, 23.0)\n\n    def test_calculate_tax_zero(self):\n        tax = self.calculator.calculate_tax(0.0)\n        self.assertEqual(tax, 0.0)\n\n    def test_calculate_total_standard_flow(self):\n        self.calculator.add_item(\"Item1\", 50.0, 1) \n        total = self.calculator.calculate_total(discount=10.0)\n        expected_discounted = 40.0\n        expected_shipping = 10.0 \n        expected_tax = 40.0 * 0.23 \n        expected_total = 40.0 + 10.0 + 9.2\n        self.assertAlmostEqual(total, expected_total)\n\n    def test_calculate_total_free_shipping(self):\n        self.calculator.add_item(\"Expensive\", 200.0, 1)\n        total = self.calculator.calculate_total()\n        expected_tax = 200.0 * 0.23\n        expected_total = 200.0 + 0.0 + 46.0\n        self.assertAlmostEqual(total, expected_total)\n\n    def test_calculate_total_empty_order(self):\n        self.assertEqual(self.calculator.calculate_total(), 0.0)\n\n    def test_total_items_sum_quantities(self):\n        self.calculator.add_item(\"A\", 10.0, 5)\n        self.calculator.add_item(\"B\", 20.0, 3)\n        self.assertEqual(self.calculator.total_items(), 8)\n\n    def test_list_items_format(self):\n        self.calculator.add_item(\"TestItem\", 10.0, 2)\n        items = self.calculator.list_items()\n        self.assertEqual(len(items), 1)\n        self.assertIn(\"TestItem\", items[0])\n        self.assertIn(\"10.0\", items[0])\n\n    def test_is_empty_initial(self):\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_after_add(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_clear_order(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n        self.assertEqual(self.calculator.total_items(), 0)\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_defaults(self):\n        self.assertEqual(self.calculator.tax_rate, 0.23)\n        self.assertEqual(self.calculator.free_shipping_threshold, 100.0)\n        self.assertEqual(self.calculator.shipping_cost, 10.0)\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.10, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.tax_rate, 0.10)\n        self.assertEqual(calc.free_shipping_threshold, 50.0)\n        self.assertEqual(calc.shipping_cost, 5.0)\n\n    def test_init_negative_values(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-5.0)\n\n    def test_add_item_single(self):\n        self.calculator.add_item(\"Apple\", 1.5, 2)\n        self.assertEqual(self.calculator.total_items(), 2)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_add_item_multiple_distinct(self):\n        self.calculator.add_item(\"Apple\", 1.5, 1)\n        self.calculator.add_item(\"Banana\", 0.5, 1)\n        self.assertEqual(self.calculator.total_items(), 2)\n        items = self.calculator.list_items()\n        self.assertEqual(len(items), 2)\n\n    def test_add_item_increment_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.add_item(\"Apple\", 1.0, 2)\n        self.assertEqual(self.calculator.total_items(), 3)\n        self.assertAlmostEqual(self.calculator.get_subtotal(), 3.0)\n\n    def test_add_item_invalid_price(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"BadPrice\", -1.0, 1)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"BadQty\", 1.0, 0)\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"BadQty\", 1.0, -1)\n\n    def test_add_item_empty_name(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"\", 1.0, 1)\n\n    def test_remove_existing_item(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_non_existent_item(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"Ghost\")\n\n    def test_subtotal_empty(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_subtotal_calculation(self):\n        self.calculator.add_item(\"Item1\", 10.0, 2)\n        self.calculator.add_item(\"Item2\", 5.0, 3) \n        self.assertAlmostEqual(self.calculator.get_subtotal(), 35.0)\n\n    def test_subtotal_float_precision(self):\n        self.calculator.add_item(\"A\", 10.1, 1)\n        self.calculator.add_item(\"B\", 20.2, 1)\n        self.assertAlmostEqual(self.calculator.get_subtotal(), 30.3)\n\n    def test_apply_discount_valid(self):\n        subtotal = 100.0\n        discount = 10.0\n        result = self.calculator.apply_discount(subtotal, discount)\n        self.assertAlmostEqual(result, 90.0)\n\n    def test_apply_discount_zero(self):\n        subtotal = 50.0\n        result = self.calculator.apply_discount(subtotal, 0.0)\n        self.assertAlmostEqual(result, 50.0)\n\n    def test_apply_discount_exceeds_subtotal(self):\n        subtotal = 50.0\n        discount = 60.0\n        result = self.calculator.apply_discount(subtotal, discount)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_shipping_below_threshold(self):\n        subtotal = 50.0 \n        shipping = self.calculator.calculate_shipping(subtotal)\n        self.assertEqual(shipping, 10.0)\n\n    def test_shipping_above_threshold(self):\n        subtotal = 150.0\n        shipping = self.calculator.calculate_shipping(subtotal)\n        self.assertEqual(shipping, 0.0)\n\n    def test_shipping_exact_threshold(self):\n        subtotal = 100.0\n        shipping = self.calculator.calculate_shipping(subtotal)\n        self.assertEqual(shipping, 0.0)\n\n    def test_calculate_tax_standard(self):\n        amount = 100.0\n        tax = self.calculator.calculate_tax(amount)\n        self.assertAlmostEqual(tax, 23.0)\n\n    def test_calculate_tax_zero(self):\n        tax = self.calculator.calculate_tax(0.0)\n        self.assertEqual(tax, 0.0)\n\n    def test_calculate_total_standard_flow(self):\n        self.calculator.add_item(\"Item1\", 50.0, 1) \n        total = self.calculator.calculate_total(discount=10.0)\n        expected_discounted = 40.0\n        expected_shipping = 10.0 \n        expected_tax = 40.0 * 0.23 \n        expected_total = 40.0 + 10.0 + 9.2\n        self.assertAlmostEqual(total, expected_total)\n\n    def test_calculate_total_free_shipping(self):\n        self.calculator.add_item(\"Expensive\", 200.0, 1)\n        total = self.calculator.calculate_total()\n        expected_tax = 200.0 * 0.23\n        expected_total = 200.0 + 0.0 + 46.0\n        self.assertAlmostEqual(total, expected_total)\n\n    def test_calculate_total_empty_order(self):\n        self.assertEqual(self.calculator.calculate_total(), 0.0)\n\n    def test_total_items_sum_quantities(self):\n        self.calculator.add_item(\"A\", 10.0, 5)\n        self.calculator.add_item(\"B\", 20.0, 3)\n        self.assertEqual(self.calculator.total_items(), 8)\n\n    def test_list_items_format(self):\n        self.calculator.add_item(\"TestItem\", 10.0, 2)\n        items = self.calculator.list_items()\n        self.assertEqual(len(items), 1)\n        self.assertIn(\"TestItem\", items[0])\n        self.assertIn(\"10.0\", items[0])\n\n    def test_is_empty_initial(self):\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_after_add(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_clear_order(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n        self.assertEqual(self.calculator.total_items(), 0)\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n```",
    "total_response_time": 108.78660488128662,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}