{
  "model": "gemini-3-pro",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2026-01-03T22:28:36.559641",
  "response_time": 117.43983340263367,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-pro\\run_022\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I have analyzed the provided `OrderCalculator` class interface.\n\n**Analysis Summary:**\n\n1.  **Initialization & Configuration:**\n    *   The `__init__` method allows configuration of `tax_rate`, `free_shipping_threshold`, and `shipping_cost`.\n    *   **Test Focus:** Verify default values and custom values during instantiation.\n\n2.  **State Management (Items):**\n    *   `add_item` and `remove_item` modify the internal state.\n    *   `clear_order` resets the state.\n    *   `is_empty` and `total_items` query the state.\n    *   **Test Focus:**\n        *   Adding items (new vs. existing, accumulating quantity).\n        *   Removing items (existing vs. non-existing).\n        *   Clearing the order.\n        *   Validation of inputs (negative prices, zero/negative quantities, empty names).\n\n3.  **Calculation Logic:**\n    *   `get_subtotal`, `apply_discount`, `calculate_shipping`, `calculate_tax`, `calculate_total`.\n    *   **Test Focus:**\n        *   **Subtotal:** Correct summation of `price * quantity`.\n        *   **Shipping:** Boundary testing around `free_shipping_threshold` (strictly greater vs. greater or equal).\n        *   **Tax:** Verification of math using the configured rate.\n        *   **Total:** The integration flow. Key questions to resolve via testing expectations:\n            *   Is discount a percentage (0.0-1.0) or a fixed amount?\n            *   Is tax applied to the discounted subtotal?\n            *   Is shipping added before or after tax? (Usually after, but needs verification).\n\n4.  **Reporting:**\n    *   `list_items`: Returns a list of strings.\n    *   **Test Focus:** Verify the format of the output strings and the order of items.\n\nI am ready to generate the test scenarios or test code upon your next instruction.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Here is a comprehensive list of unit test scenarios for the `OrderCalculator` class, categorized by functionality:\n\n### 1. Initialization (`__init__`)\n*   **Scenario 1.1:** `test_init_defaults`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify that an instance created without arguments has the expected default values (`tax_rate=0.23`, `free_shipping_threshold=100.0`, `shipping_cost=10.0`).\n*   **Scenario 1.2:** `test_init_custom_values`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify that an instance created with custom arguments correctly stores those values.\n\n### 2. Item Management (`add_item`, `remove_item`, `clear_order`)\n*   **Scenario 2.1:** `test_add_single_item`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify adding a valid item correctly updates the internal list/dictionary.\n*   **Scenario 2.2:** `test_add_multiple_items`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify adding different items results in a correct collection of distinct items.\n*   **Scenario 2.3:** `test_add_existing_item_accumulates_quantity`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify that adding an item with the same name as an existing one updates the quantity of the existing entry rather than creating a duplicate.\n*   **Scenario 2.4:** `test_add_item_invalid_price`\n    *   **Type:** Invalid Input\n    *   **Intent:** Ensure adding an item with a negative price raises a `ValueError` (or handles it gracefully).\n*   **Scenario 2.5:** `test_add_item_invalid_quantity`\n    *   **Type:** Invalid Input\n    *   **Intent:** Ensure adding an item with 0 or negative quantity raises a `ValueError`.\n*   **Scenario 2.6:** `test_remove_existing_item`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify that removing a known item successfully deletes it from the order.\n*   **Scenario 2.7:** `test_remove_non_existent_item`\n    *   **Type:** Edge Case/Exception\n    *   **Intent:** Verify behavior when removing an item not in the list (should likely raise `KeyError` or `ValueError`).\n*   **Scenario 2.8:** `test_clear_order`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify that calling `clear_order` removes all items and resets the state to empty.\n\n### 3. State Queries (`is_empty`, `total_items`, `list_items`)\n*   **Scenario 3.1:** `test_is_empty_initially`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify `is_empty()` returns `True` for a newly created instance.\n*   **Scenario 3.2:** `test_is_empty_after_add`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify `is_empty()` returns `False` after adding an item.\n*   **Scenario 3.3:** `test_total_items_calculation`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify `total_items()` returns the sum of quantities of all items (not just the count of unique names).\n*   **Scenario 3.4:** `test_list_items_format`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify `list_items()` returns a list of strings formatted correctly (e.g., \"Name: Price x Quantity\").\n\n### 4. Financial Calculations (`get_subtotal`, `apply_discount`, `calculate_shipping`, `calculate_tax`)\n*   **Scenario 4.1:** `test_get_subtotal_empty`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify subtotal is 0.0 when the order is empty.\n*   **Scenario 4.2:** `test_get_subtotal_mixed_items`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify subtotal is the correct sum of (price * quantity) for multiple items.\n*   **Scenario 4.3:** `test_apply_discount_valid`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify the math for applying a valid discount (checking if it reduces the amount correctly).\n*   **Scenario 4.4:** `test_apply_discount_invalid`\n    *   **Type:** Invalid Input\n    *   **Intent:** Verify behavior for negative discounts or discounts > 1.0 (assuming discount is a percentage).\n*   **Scenario 4.5:** `test_calculate_shipping_below_threshold`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify shipping cost is applied when the subtotal is below `free_shipping_threshold`.\n*   **Scenario 4.6:** `test_calculate_shipping_at_threshold`\n    *   **Type:** Edge Case\n    *   **Intent:** Verify behavior exactly at the threshold (is it free or paid?).\n*   **Scenario 4.7:** `test_calculate_shipping_above_threshold`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify shipping cost is 0.0 when subtotal exceeds the threshold.\n*   **Scenario 4.8:** `test_calculate_tax`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify tax is calculated correctly based on the initialized tax rate.\n\n### 5. Integration (`calculate_total`)\n*   **Scenario 5.1:** `test_calculate_total_no_discount`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify the full calculation pipeline: Subtotal + Tax + Shipping (verify order of operations, usually Tax is on Subtotal, Shipping is separate).\n*   **Scenario 5.2:** `test_calculate_total_with_discount`\n    *   **Type:** Normal Use\n    *   **Intent:** Verify the calculation pipeline with a discount applied (e.g., Does tax apply to the discounted price? Is free shipping based on pre- or post-discount price?).\n*   **Scenario 5.3:** `test_calculate_total_free_shipping_logic`\n    *   **Type:** Complex Logic\n    *   **Intent:** Ensure that if a discount drops the price below the shipping threshold, shipping logic behaves consistently (depending on business rules).",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.order = OrderCalculator()\n\n    def test_init_defaults(self):\n        self.assertEqual(self.order.calculate_tax(100.0), 23.0)\n        self.assertEqual(self.order.calculate_shipping(99.0), 10.0)\n        self.assertEqual(self.order.calculate_shipping(100.0), 0.0)\n\n    def test_init_custom_values(self):\n        custom_order = OrderCalculator(tax_rate=0.10, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(custom_order.calculate_tax(100.0), 10.0)\n        self.assertEqual(custom_order.calculate_shipping(49.0), 5.0)\n        self.assertEqual(custom_order.calculate_shipping(50.0), 0.0)\n\n    def test_add_single_item(self):\n        self.order.add_item(\"Apple\", 1.5, 10)\n        self.assertEqual(self.order.total_items(), 10)\n        self.assertEqual(self.order.get_subtotal(), 15.0)\n\n    def test_add_multiple_items(self):\n        self.order.add_item(\"Apple\", 1.5, 2)\n        self.order.add_item(\"Banana\", 2.0, 3)\n        self.assertEqual(self.order.total_items(), 5)\n        self.assertEqual(self.order.get_subtotal(), 9.0)\n\n    def test_add_existing_item_accumulates_quantity(self):\n        self.order.add_item(\"Apple\", 1.0, 5)\n        self.order.add_item(\"Apple\", 1.0, 3)\n        self.assertEqual(self.order.total_items(), 8)\n        self.assertEqual(self.order.get_subtotal(), 8.0)\n\n    def test_add_item_invalid_price(self):\n        with self.assertRaises(ValueError):\n            self.order.add_item(\"BadItem\", -5.0)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.order.add_item(\"BadItem\", 5.0, 0)\n        with self.assertRaises(ValueError):\n            self.order.add_item(\"BadItem\", 5.0, -1)\n\n    def test_remove_existing_item(self):\n        self.order.add_item(\"Apple\", 1.0)\n        self.order.remove_item(\"Apple\")\n        self.assertTrue(self.order.is_empty())\n        self.assertEqual(self.order.get_subtotal(), 0.0)\n\n    def test_remove_non_existent_item(self):\n        with self.assertRaises((ValueError, KeyError)):\n             self.order.remove_item(\"NonExistentItem\")\n\n    def test_clear_order(self):\n        self.order.add_item(\"Apple\", 1.0)\n        self.order.clear_order()\n        self.assertTrue(self.order.is_empty())\n        self.assertEqual(self.order.total_items(), 0)\n\n    def test_is_empty_initially(self):\n        self.assertTrue(self.order.is_empty())\n\n    def test_is_empty_after_add(self):\n        self.order.add_item(\"Apple\", 1.0)\n        self.assertFalse(self.order.is_empty())\n\n    def test_total_items_calculation(self):\n        self.order.add_item(\"A\", 10.0, 2)\n        self.order.add_item(\"B\", 5.0, 3)\n        self.assertEqual(self.order.total_items(), 5)\n\n    def test_list_items_format(self):\n        self.order.add_item(\"Apple\", 1.5, 2)\n        items = self.order.list_items()\n        self.assertIsInstance(items, list)\n        self.assertEqual(len(items), 1)\n        self.assertIn(\"Apple\", items[0])\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.order.get_subtotal(), 0.0)\n\n    def test_get_subtotal_mixed_items(self):\n        self.order.add_item(\"A\", 10.0, 2)\n        self.order.add_item(\"B\", 5.5, 2)\n        self.assertEqual(self.order.get_subtotal(), 31.0)\n\n    def test_apply_discount_valid(self):\n        self.assertEqual(self.order.apply_discount(100.0, 0.1), 90.0)\n\n    def test_apply_discount_invalid(self):\n        with self.assertRaises(ValueError):\n            self.order.apply_discount(100.0, -0.1)\n        with self.assertRaises(ValueError):\n            self.order.apply_discount(100.0, 1.5)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertEqual(self.order.calculate_shipping(50.0), 10.0)\n\n    def test_calculate_shipping_at_threshold(self):\n        self.assertEqual(self.order.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertEqual(self.order.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_tax(self):\n        self.assertEqual(self.order.calculate_tax(100.0), 23.0)\n\n    def test_calculate_total_no_discount(self):\n        self.order.add_item(\"X\", 50.0, 2)\n        self.assertEqual(self.order.calculate_total(), 123.0)\n        \n        self.order.clear_order()\n        self.order.add_item(\"Y\", 40.0)\n        self.assertAlmostEqual(self.order.calculate_total(), 59.2)\n\n    def test_calculate_total_with_discount(self):\n        self.order.add_item(\"X\", 100.0, 2)\n        self.assertEqual(self.order.calculate_total(discount=0.5), 123.0)\n\n    def test_calculate_total_free_shipping_logic(self):\n        self.order.add_item(\"X\", 100.0, 1)\n        self.assertAlmostEqual(self.order.calculate_total(discount=0.1), 120.7)\n\nif __name__ == '__main__':\n    unittest.main()\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.order = OrderCalculator()\n\n    def test_init_defaults(self):\n        self.assertEqual(self.order.calculate_tax(100.0), 23.0)\n        self.assertEqual(self.order.calculate_shipping(99.0), 10.0)\n        self.assertEqual(self.order.calculate_shipping(100.0), 0.0)\n\n    def test_init_custom_values(self):\n        custom_order = OrderCalculator(tax_rate=0.10, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(custom_order.calculate_tax(100.0), 10.0)\n        self.assertEqual(custom_order.calculate_shipping(49.0), 5.0)\n        self.assertEqual(custom_order.calculate_shipping(50.0), 0.0)\n\n    def test_add_single_item(self):\n        self.order.add_item(\"Apple\", 1.5, 10)\n        self.assertEqual(self.order.total_items(), 10)\n        self.assertEqual(self.order.get_subtotal(), 15.0)\n\n    def test_add_multiple_items(self):\n        self.order.add_item(\"Apple\", 1.5, 2)\n        self.order.add_item(\"Banana\", 2.0, 3)\n        self.assertEqual(self.order.total_items(), 5)\n        self.assertEqual(self.order.get_subtotal(), 9.0)\n\n    def test_add_existing_item_accumulates_quantity(self):\n        self.order.add_item(\"Apple\", 1.0, 5)\n        self.order.add_item(\"Apple\", 1.0, 3)\n        self.assertEqual(self.order.total_items(), 8)\n        self.assertEqual(self.order.get_subtotal(), 8.0)\n\n    def test_add_item_invalid_price(self):\n        with self.assertRaises(ValueError):\n            self.order.add_item(\"BadItem\", -5.0)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.order.add_item(\"BadItem\", 5.0, 0)\n        with self.assertRaises(ValueError):\n            self.order.add_item(\"BadItem\", 5.0, -1)\n\n    def test_remove_existing_item(self):\n        self.order.add_item(\"Apple\", 1.0)\n        self.order.remove_item(\"Apple\")\n        self.assertTrue(self.order.is_empty())\n        self.assertEqual(self.order.get_subtotal(), 0.0)\n\n    def test_remove_non_existent_item(self):\n        with self.assertRaises((ValueError, KeyError)):\n             self.order.remove_item(\"NonExistentItem\")\n\n    def test_clear_order(self):\n        self.order.add_item(\"Apple\", 1.0)\n        self.order.clear_order()\n        self.assertTrue(self.order.is_empty())\n        self.assertEqual(self.order.total_items(), 0)\n\n    def test_is_empty_initially(self):\n        self.assertTrue(self.order.is_empty())\n\n    def test_is_empty_after_add(self):\n        self.order.add_item(\"Apple\", 1.0)\n        self.assertFalse(self.order.is_empty())\n\n    def test_total_items_calculation(self):\n        self.order.add_item(\"A\", 10.0, 2)\n        self.order.add_item(\"B\", 5.0, 3)\n        self.assertEqual(self.order.total_items(), 5)\n\n    def test_list_items_format(self):\n        self.order.add_item(\"Apple\", 1.5, 2)\n        items = self.order.list_items()\n        self.assertIsInstance(items, list)\n        self.assertEqual(len(items), 1)\n        self.assertIn(\"Apple\", items[0])\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.order.get_subtotal(), 0.0)\n\n    def test_get_subtotal_mixed_items(self):\n        self.order.add_item(\"A\", 10.0, 2)\n        self.order.add_item(\"B\", 5.5, 2)\n        self.assertEqual(self.order.get_subtotal(), 31.0)\n\n    def test_apply_discount_valid(self):\n        self.assertEqual(self.order.apply_discount(100.0, 0.1), 90.0)\n\n    def test_apply_discount_invalid(self):\n        with self.assertRaises(ValueError):\n            self.order.apply_discount(100.0, -0.1)\n        with self.assertRaises(ValueError):\n            self.order.apply_discount(100.0, 1.5)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertEqual(self.order.calculate_shipping(50.0), 10.0)\n\n    def test_calculate_shipping_at_threshold(self):\n        self.assertEqual(self.order.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertEqual(self.order.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_tax(self):\n        self.assertEqual(self.order.calculate_tax(100.0), 23.0)\n\n    def test_calculate_total_no_discount(self):\n        self.order.add_item(\"X\", 50.0, 2)\n        self.assertEqual(self.order.calculate_total(), 123.0)\n        \n        self.order.clear_order()\n        self.order.add_item(\"Y\", 40.0)\n        self.assertAlmostEqual(self.order.calculate_total(), 59.2)\n\n    def test_calculate_total_with_discount(self):\n        self.order.add_item(\"X\", 100.0, 2)\n        self.assertEqual(self.order.calculate_total(discount=0.5), 123.0)\n\n    def test_calculate_total_free_shipping_logic(self):\n        self.order.add_item(\"X\", 100.0, 1)\n        self.assertAlmostEqual(self.order.calculate_total(discount=0.1), 120.7)\n\nif __name__ == '__main__':\n    unittest.main()\n```",
    "total_response_time": 117.43983340263367,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}