{
  "model": "gemini-3-pro",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2026-01-03T22:14:44.748860",
  "response_time": 117.02214622497559,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-pro\\run_021\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I have analyzed the `OrderCalculator` class interface.\n\n**Class Analysis:**\n\n*   **Core Responsibility:** Management of an order lifecycle, including item management (add/remove), calculation of financial metrics (subtotal, tax, shipping, total), and state queries (is empty, list items).\n*   **Initialization:** Accepts configuration for `tax_rate`, `free_shipping_threshold`, and `shipping_cost`.\n*   **State Management:**\n    *   `add_item`: Modifies state by adding items.\n    *   `remove_item`: Modifies state by removing items.\n    *   `clear_order`: Resets state.\n*   **Calculations:**\n    *   `get_subtotal`: Base calculation from items.\n    *   `apply_discount`: Logic for price reduction.\n    *   `calculate_shipping`: Conditional logic based on threshold.\n    *   `calculate_tax`: Standard percentage calculation.\n    *   `calculate_total`: Aggregates all financial components.\n*   **Reporting:**\n    *   `total_items`, `list_items`, `is_empty`: Provide insights into the current order state.\n\nI am ready to proceed with generating the test scenarios or test code as requested.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Here are the relevant unit test scenarios for the `OrderCalculator` class:\n\n### 1. Initialization (`__init__`)\n*   **`test_init_defaults`** (Normal): Verify that the calculator initializes with the default tax rate (0.23), free shipping threshold (100.0), and shipping cost (10.0).\n*   **`test_init_custom_values`** (Normal): Verify that the calculator initializes correctly with custom values provided during instantiation.\n\n### 2. Adding Items (`add_item`)\n*   **`test_add_single_item`** (Normal): Add a single valid item and verify the internal state reflects one item with correct details.\n*   **`test_add_item_multiple_quantity`** (Normal): Add an item with quantity > 1 and verify it is stored correctly.\n*   **`test_add_item_zero_quantity`** (Edge Case): Attempt to add an item with quantity 0. Expect no change or a specific handling (depending on implementation policy, usually treated as invalid or no-op).\n*   **`test_add_item_negative_price`** (Invalid Input): Attempt to add an item with a negative price. Expect a `ValueError`.\n*   **`test_add_item_negative_quantity`** (Invalid Input): Attempt to add an item with a negative quantity. Expect a `ValueError`.\n*   **`test_add_duplicate_item`** (Normal/Edge Case): Add an item with a name that already exists. Verify behavior (does it update quantity of the existing entry or add a new entry?).\n\n### 3. Removing Items (`remove_item`)\n*   **`test_remove_existing_item`** (Normal): Remove an item that exists in the order. Verify it is no longer in the list.\n*   **`test_remove_non_existent_item`** (Exception): Attempt to remove an item that is not in the order. Expect a `ValueError` or specific exception.\n*   **`test_remove_from_empty_order`** (Exception): Attempt to call `remove_item` on an empty order.\n\n### 4. Subtotal Calculation (`get_subtotal`)\n*   **`test_subtotal_empty_order`** (Normal): Verify subtotal is 0.0 for a new/empty order.\n*   **`test_subtotal_single_item`** (Normal): Verify subtotal equals price * quantity for a single item.\n*   **`test_subtotal_multiple_items`** (Normal): Verify subtotal is the correct sum of (price * quantity) for multiple different items.\n\n### 5. Discount Logic (`apply_discount`)\n*   **`test_apply_discount_valid`** (Normal): Apply a valid discount (e.g., 10.0) to a subtotal and verify the returned value is reduced correctly.\n*   **`test_apply_discount_zero`** (Normal): Apply a 0.0 discount. Verify the subtotal remains unchanged.\n*   **`test_apply_discount_exceeding_subtotal`** (Edge Case): Apply a discount larger than the subtotal. Verify the result is 0.0 (total should not be negative).\n*   **`test_apply_discount_negative`** (Invalid Input): Attempt to apply a negative discount. Expect a `ValueError`.\n\n### 6. Shipping Calculation (`calculate_shipping`)\n*   **`test_shipping_below_threshold`** (Normal): Calculate shipping for a subtotal below the `free_shipping_threshold`. Verify it returns the standard `shipping_cost`.\n*   **`test_shipping_exact_threshold`** (Edge Case): Calculate shipping for a subtotal exactly equal to the threshold. Verify behavior (usually free or not, strict definition needed).\n*   **`test_shipping_above_threshold`** (Normal): Calculate shipping for a subtotal above the threshold. Verify it returns 0.0.\n\n### 7. Tax Calculation (`calculate_tax`)\n*   **`test_calculate_tax_normal`** (Normal): Verify tax is calculated correctly (amount * tax_rate).\n*   **`test_calculate_tax_zero_amount`** (Edge Case): Verify tax is 0.0 when the amount is 0.0.\n\n### 8. Total Calculation (`calculate_total`)\n*   **`test_calculate_total_empty`** (Normal): Verify total is 0.0 for an empty order.\n*   **`test_calculate_total_simple`** (Normal): Calculate total with items, no discount, below shipping threshold. Verify `(subtotal + shipping) * (1 + tax_rate)` logic (or specific tax logic implies tax on products vs shipping).\n*   **`test_calculate_total_with_discount`** (Normal): Calculate total with a discount applied. Verify math involves `(subtotal - discount) + shipping + tax`.\n*   **`test_calculate_total_free_shipping`** (Normal): Calculate total where subtotal exceeds the free shipping threshold. Verify shipping is not added.\n\n### 9. Utility Methods (`total_items`, `clear_order`, `list_items`, `is_empty`)\n*   **`test_total_items`** (Normal): Verify the count sums up all quantities, not just unique entries.\n*   **`test_is_empty_true`** (Normal): Verify returns `True` for a new order.\n*   **`test_is_empty_false`** (Normal): Verify returns `False` after adding an item.\n*   **`test_list_items`** (Normal): Verify it returns a list of strings containing item names.\n*   **`test_clear_order`** (Normal): Add items, call `clear_order`, verify `is_empty` is True, `total_items` is 0, and `get_subtotal` is 0.0.",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calc = OrderCalculator()\n\n    def test_init_defaults(self):\n        c = OrderCalculator()\n        self.assertEqual(c.calculate_shipping(1.0), 10.0)\n\n    def test_init_custom_values(self):\n        c = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(c.calculate_shipping(40.0), 5.0)\n        self.assertEqual(c.calculate_shipping(60.0), 0.0)\n\n    def test_add_single_item(self):\n        self.calc.add_item(\"Apple\", 1.5, 1)\n        self.assertEqual(self.calc.total_items(), 1)\n        self.assertFalse(self.calc.is_empty())\n\n    def test_add_item_multiple_quantity(self):\n        self.calc.add_item(\"Apple\", 1.0, 5)\n        self.assertEqual(self.calc.get_subtotal(), 5.0)\n\n    def test_add_item_zero_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"Ghost\", 10.0, 0)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadPrice\", -5.0)\n\n    def test_add_item_negative_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadQty\", 5.0, -1)\n\n    def test_add_duplicate_item(self):\n        self.calc.add_item(\"Apple\", 2.0, 1)\n        self.calc.add_item(\"Apple\", 2.0, 1)\n        self.assertEqual(self.calc.get_subtotal(), 4.0)\n        self.assertEqual(self.calc.total_items(), 2)\n\n    def test_remove_existing_item(self):\n        self.calc.add_item(\"Apple\", 10.0)\n        self.calc.remove_item(\"Apple\")\n        self.assertTrue(self.calc.is_empty())\n\n    def test_remove_non_existent_item(self):\n        with self.assertRaises(ValueError):\n            self.calc.remove_item(\"Ghost\")\n\n    def test_remove_from_empty_order(self):\n        with self.assertRaises(ValueError):\n            self.calc.remove_item(\"Ghost\")\n\n    def test_subtotal_empty_order(self):\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_subtotal_single_item(self):\n        self.calc.add_item(\"Item1\", 10.0, 2)\n        self.assertEqual(self.calc.get_subtotal(), 20.0)\n\n    def test_subtotal_multiple_items(self):\n        self.calc.add_item(\"Item1\", 10.0, 1)\n        self.calc.add_item(\"Item2\", 5.0, 2)\n        self.assertEqual(self.calc.get_subtotal(), 20.0)\n\n    def test_apply_discount_valid(self):\n        sub = 100.0\n        disc = 10.0\n        self.assertEqual(self.calc.apply_discount(sub, disc), 90.0)\n\n    def test_apply_discount_zero(self):\n        self.assertEqual(self.calc.apply_discount(100.0, 0.0), 100.0)\n\n    def test_apply_discount_exceeding_subtotal(self):\n        self.assertEqual(self.calc.apply_discount(50.0, 60.0), 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calc.apply_discount(100.0, -10.0)\n\n    def test_shipping_below_threshold(self):\n        self.assertEqual(self.calc.calculate_shipping(50.0), 10.0)\n\n    def test_shipping_exact_threshold(self):\n        self.assertEqual(self.calc.calculate_shipping(100.0), 0.0)\n\n    def test_shipping_above_threshold(self):\n        self.assertEqual(self.calc.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_tax_normal(self):\n        self.assertAlmostEqual(self.calc.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero_amount(self):\n        self.assertEqual(self.calc.calculate_tax(0.0), 0.0)\n\n    def test_calculate_total_empty(self):\n        self.assertEqual(self.calc.calculate_total(), 0.0)\n\n    def test_calculate_total_simple(self):\n        self.calc.add_item(\"Item\", 50.0)\n        total = self.calc.calculate_total()\n        self.assertTrue(total > 50.0)\n\n    def test_calculate_total_with_discount(self):\n        self.calc.add_item(\"Item\", 200.0)\n        total = self.calc.calculate_total(discount=20.0)\n        self.assertTrue(total > 0)\n\n    def test_calculate_total_free_shipping(self):\n        self.calc.add_item(\"Item\", 150.0)\n        expected_tax = 150.0 * 0.23\n        self.assertAlmostEqual(self.calc.calculate_total(), 150.0 + expected_tax)\n\n    def test_total_items(self):\n        self.calc.add_item(\"A\", 1, 2)\n        self.calc.add_item(\"B\", 1, 3)\n        self.assertEqual(self.calc.total_items(), 5)\n\n    def test_is_empty_true(self):\n        self.assertTrue(self.calc.is_empty())\n\n    def test_is_empty_false(self):\n        self.calc.add_item(\"A\", 1)\n        self.assertFalse(self.calc.is_empty())\n\n    def test_list_items(self):\n        self.calc.add_item(\"A\", 1)\n        self.assertIn(\"A\", self.calc.list_items())\n\n    def test_clear_order(self):\n        self.calc.add_item(\"A\", 1)\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calc = OrderCalculator()\n\n    def test_init_defaults(self):\n        c = OrderCalculator()\n        self.assertEqual(c.calculate_shipping(1.0), 10.0)\n\n    def test_init_custom_values(self):\n        c = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(c.calculate_shipping(40.0), 5.0)\n        self.assertEqual(c.calculate_shipping(60.0), 0.0)\n\n    def test_add_single_item(self):\n        self.calc.add_item(\"Apple\", 1.5, 1)\n        self.assertEqual(self.calc.total_items(), 1)\n        self.assertFalse(self.calc.is_empty())\n\n    def test_add_item_multiple_quantity(self):\n        self.calc.add_item(\"Apple\", 1.0, 5)\n        self.assertEqual(self.calc.get_subtotal(), 5.0)\n\n    def test_add_item_zero_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"Ghost\", 10.0, 0)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadPrice\", -5.0)\n\n    def test_add_item_negative_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadQty\", 5.0, -1)\n\n    def test_add_duplicate_item(self):\n        self.calc.add_item(\"Apple\", 2.0, 1)\n        self.calc.add_item(\"Apple\", 2.0, 1)\n        self.assertEqual(self.calc.get_subtotal(), 4.0)\n        self.assertEqual(self.calc.total_items(), 2)\n\n    def test_remove_existing_item(self):\n        self.calc.add_item(\"Apple\", 10.0)\n        self.calc.remove_item(\"Apple\")\n        self.assertTrue(self.calc.is_empty())\n\n    def test_remove_non_existent_item(self):\n        with self.assertRaises(ValueError):\n            self.calc.remove_item(\"Ghost\")\n\n    def test_remove_from_empty_order(self):\n        with self.assertRaises(ValueError):\n            self.calc.remove_item(\"Ghost\")\n\n    def test_subtotal_empty_order(self):\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_subtotal_single_item(self):\n        self.calc.add_item(\"Item1\", 10.0, 2)\n        self.assertEqual(self.calc.get_subtotal(), 20.0)\n\n    def test_subtotal_multiple_items(self):\n        self.calc.add_item(\"Item1\", 10.0, 1)\n        self.calc.add_item(\"Item2\", 5.0, 2)\n        self.assertEqual(self.calc.get_subtotal(), 20.0)\n\n    def test_apply_discount_valid(self):\n        sub = 100.0\n        disc = 10.0\n        self.assertEqual(self.calc.apply_discount(sub, disc), 90.0)\n\n    def test_apply_discount_zero(self):\n        self.assertEqual(self.calc.apply_discount(100.0, 0.0), 100.0)\n\n    def test_apply_discount_exceeding_subtotal(self):\n        self.assertEqual(self.calc.apply_discount(50.0, 60.0), 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calc.apply_discount(100.0, -10.0)\n\n    def test_shipping_below_threshold(self):\n        self.assertEqual(self.calc.calculate_shipping(50.0), 10.0)\n\n    def test_shipping_exact_threshold(self):\n        self.assertEqual(self.calc.calculate_shipping(100.0), 0.0)\n\n    def test_shipping_above_threshold(self):\n        self.assertEqual(self.calc.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_tax_normal(self):\n        self.assertAlmostEqual(self.calc.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero_amount(self):\n        self.assertEqual(self.calc.calculate_tax(0.0), 0.0)\n\n    def test_calculate_total_empty(self):\n        self.assertEqual(self.calc.calculate_total(), 0.0)\n\n    def test_calculate_total_simple(self):\n        self.calc.add_item(\"Item\", 50.0)\n        total = self.calc.calculate_total()\n        self.assertTrue(total > 50.0)\n\n    def test_calculate_total_with_discount(self):\n        self.calc.add_item(\"Item\", 200.0)\n        total = self.calc.calculate_total(discount=20.0)\n        self.assertTrue(total > 0)\n\n    def test_calculate_total_free_shipping(self):\n        self.calc.add_item(\"Item\", 150.0)\n        expected_tax = 150.0 * 0.23\n        self.assertAlmostEqual(self.calc.calculate_total(), 150.0 + expected_tax)\n\n    def test_total_items(self):\n        self.calc.add_item(\"A\", 1, 2)\n        self.calc.add_item(\"B\", 1, 3)\n        self.assertEqual(self.calc.total_items(), 5)\n\n    def test_is_empty_true(self):\n        self.assertTrue(self.calc.is_empty())\n\n    def test_is_empty_false(self):\n        self.calc.add_item(\"A\", 1)\n        self.assertFalse(self.calc.is_empty())\n\n    def test_list_items(self):\n        self.calc.add_item(\"A\", 1)\n        self.assertIn(\"A\", self.calc.list_items())\n\n    def test_clear_order(self):\n        self.calc.add_item(\"A\", 1)\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n```",
    "total_response_time": 117.02214622497559,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}