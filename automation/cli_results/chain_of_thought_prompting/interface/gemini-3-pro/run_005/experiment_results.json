{
  "model": "gemini-3-pro",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2025-12-30T09:32:24.611252",
  "response_time": 132.2358021736145,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-pro\\run_005\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I have analyzed the `OrderCalculator` class interface.\n\n**Analysis Summary:**\n\n*   **Core Responsibility:** The class manages a shopping cart state (items, quantities) and performs financial calculations (subtotal, tax, shipping, total).\n*   **State Management:** Methods `add_item`, `remove_item`, `clear_order` modify the internal state, while `is_empty`, `total_items`, and `list_items` query it.\n*   **Business Logic:**\n    *   **Shipping:** Logic appears to depend on a `free_shipping_threshold` (likely: if subtotal >= threshold, shipping is 0, else `shipping_cost`).\n    *   **Tax:** Calculated based on a configurable `tax_rate`.\n    *   **Discount:** Applied to the subtotal, influencing the final total and potentially the shipping calculation context.\n*   **Key Test Areas identified:**\n    1.  **Initialization:** Verifying default vs. custom values for tax, shipping cost, and threshold.\n    2.  **Item Management:** Adding valid items, updating quantities, removing existing/non-existing items, clearing the order.\n    3.  **Calculations:** Verifying math for subtotal, tax, shipping (above/below threshold), and final total with and without discounts.\n    4.  **Edge Cases:** Negative inputs (price, quantity, discount), zero values, boundary checks (exact threshold matches), and floating-point precision.\n\nI am ready for the next step. Please provide your specific instructions or ask for the test scenarios/code.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Here are the relevant unit test scenarios for the `OrderCalculator` class:\n\n### 1. Initialization (`__init__`)\n*   **Normal Use:** Verify that initializing without arguments sets the default values (tax=0.23, threshold=100.0, shipping=10.0).\n*   **Normal Use:** Verify that initializing with custom arguments correctly sets the provided values.\n*   **Invalid Input:** Attempt to initialize with negative values for `tax_rate`, `free_shipping_threshold`, or `shipping_cost` (expecting normalization or `ValueError`).\n\n### 2. Adding Items (`add_item`)\n*   **Normal Use:** Add a new item with a valid name, price, and quantity. Verify it appears in the order.\n*   **Normal Use:** Add an item that already exists in the order. Verify the quantity updates (aggregates) rather than creating a duplicate entry.\n*   **Normal Use:** Add an item without specifying quantity. Verify default quantity is 1.\n*   **Invalid Input:** Attempt to add an item with a negative or zero price (expecting `ValueError`).\n*   **Invalid Input:** Attempt to add an item with a negative or zero quantity (expecting `ValueError`).\n*   **Invalid Input:** Attempt to add an item with an empty string as the name (expecting `ValueError`).\n\n### 3. Removing Items (`remove_item`)\n*   **Normal Use:** Remove an existing item from the order. Verify it is no longer in the list or total calculations.\n*   **Exception/Edge Case:** Attempt to remove an item that does not exist in the order (expecting `KeyError` or graceful silence depending on implementation philosophy).\n\n### 4. Subtotal Calculation (`get_subtotal`)\n*   **Normal Use:** Calculate subtotal for an order with multiple items (sum of `price * quantity`).\n*   **Edge Case:** Calculate subtotal for an empty order (expecting 0.0).\n*   **Precision:** Calculate subtotal where floating-point addition might be tricky (e.g., 0.1 + 0.2) to ensure precision handling.\n\n### 5. Discount Logic (`apply_discount`)\n*   **Normal Use:** Apply a valid discount (e.g., 10.0) to a subtotal (e.g., 100.0). Verify the returned value is reduced correctly.\n*   **Edge Case:** Apply a discount larger than the subtotal. Verify the result is 0.0 (total should not be negative).\n*   **Invalid Input:** Apply a negative discount value (expecting `ValueError`).\n*   **Edge Case:** Apply a discount of 0.0. Verify the subtotal remains unchanged.\n\n### 6. Shipping Calculation (`calculate_shipping`)\n*   **Normal Use:** Calculate shipping for a discounted subtotal *below* the `free_shipping_threshold`. Verify standard `shipping_cost` is returned.\n*   **Normal Use:** Calculate shipping for a discounted subtotal *above* the `free_shipping_threshold`. Verify 0.0 is returned.\n*   **Boundary Case:** Calculate shipping for a discounted subtotal *exactly equal to* the `free_shipping_threshold`. Verify 0.0 is returned (standard inclusive behavior).\n*   **Edge Case:** Calculate shipping when the cart is empty (subtotal 0). Expecting 0.0 shipping (or standard cost, depending on business logic, but usually 0).\n\n### 7. Tax Calculation (`calculate_tax`)\n*   **Normal Use:** Calculate tax on a standard positive amount based on the initialized `tax_rate`.\n*   **Edge Case:** Calculate tax on 0.0 amount. Verify result is 0.0.\n\n### 8. Total Calculation (`calculate_total`)\n*   **Normal Use:** Calculate total for a standard order (Subtotal - Discount + Shipping + Tax).\n*   **Integration:** Verify that `calculate_total` integrates the logic of `calculate_shipping` (e.g., if discount drops subtotal below threshold, shipping re-appears).\n*   **Integration:** Verify that `calculate_total` applies tax to the correct base (typically `subtotal - discount + shipping` or `subtotal - discount`, depending on specific tax laws, but consistency must be tested).\n\n### 9. Item Management (`total_items`, `list_items`, `is_empty`)\n*   **Normal Use (`total_items`):** Verify it returns the sum of all item quantities, not just the count of unique items.\n*   **Normal Use (`list_items`):** Verify it returns a list of names of all items currently in the order.\n*   **Normal Use (`is_empty`):** Verify it returns `True` for a new instance.\n*   **State Change (`is_empty`):** Verify it returns `False` after adding an item and `True` again after removing all items.\n\n### 10. Clearing Order (`clear_order`)\n*   **Normal Use:** Call `clear_order` on a populated order. Verify `is_empty` becomes true, `get_subtotal` becomes 0.0, and `list_items` becomes empty.",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calc = OrderCalculator()\n\n    def test_init_defaults(self):\n        self.assertEqual(self.calc.tax_rate, 0.23)\n        self.assertEqual(self.calc.free_shipping_threshold, 100.0)\n        self.assertEqual(self.calc.shipping_cost, 10.0)\n        self.assertTrue(self.calc.is_empty())\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.tax_rate, 0.1)\n        self.assertEqual(calc.free_shipping_threshold, 50.0)\n        self.assertEqual(calc.shipping_cost, 5.0)\n\n    def test_init_negative_values(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n        with self.assertRaises(ValueError):\n            OrderCalculator(free_shipping_threshold=-10.0)\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-5.0)\n\n    def test_add_item_valid(self):\n        self.calc.add_item(\"Apple\", 1.5, 10)\n        self.assertIn(\"Apple\", self.calc.list_items())\n        self.assertEqual(self.calc.total_items(), 10)\n        self.assertEqual(self.calc.get_subtotal(), 15.0)\n\n    def test_add_item_duplicate_update_quantity(self):\n        self.calc.add_item(\"Apple\", 1.5, 2)\n        self.calc.add_item(\"Apple\", 1.5, 3)\n        self.assertEqual(self.calc.total_items(), 5)\n        self.assertEqual(self.calc.get_subtotal(), 7.5)\n\n    def test_add_item_default_quantity(self):\n        self.calc.add_item(\"Banana\", 0.5)\n        self.assertEqual(self.calc.total_items(), 1)\n        self.assertEqual(self.calc.get_subtotal(), 0.5)\n\n    def test_add_item_invalid_price(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadPrice\", -1.0)\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"ZeroPrice\", 0.0)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadQty\", 10.0, -1)\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"ZeroQty\", 10.0, 0)\n\n    def test_add_item_empty_name(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"\", 10.0)\n\n    def test_remove_item_existing(self):\n        self.calc.add_item(\"Apple\", 1.0, 5)\n        self.calc.remove_item(\"Apple\")\n        self.assertTrue(self.calc.is_empty())\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_remove_item_non_existent(self):\n        with self.assertRaises(KeyError):\n            self.calc.remove_item(\"Ghost\")\n\n    def test_get_subtotal_multiple_items(self):\n        self.calc.add_item(\"A\", 10.0, 2)\n        self.calc.add_item(\"B\", 5.5, 1)\n        self.assertEqual(self.calc.get_subtotal(), 25.5)\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_get_subtotal_precision(self):\n        self.calc.add_item(\"A\", 0.1, 1)\n        self.calc.add_item(\"B\", 0.2, 1)\n        self.assertAlmostEqual(self.calc.get_subtotal(), 0.3)\n\n    def test_apply_discount_valid(self):\n        result = self.calc.apply_discount(100.0, 10.0)\n        self.assertEqual(result, 90.0)\n\n    def test_apply_discount_exceeds_subtotal(self):\n        result = self.calc.apply_discount(50.0, 60.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calc.apply_discount(100.0, -10.0)\n\n    def test_apply_discount_zero(self):\n        result = self.calc.apply_discount(100.0, 0.0)\n        self.assertEqual(result, 100.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        cost = self.calc.calculate_shipping(99.99)\n        self.assertEqual(cost, 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        cost = self.calc.calculate_shipping(150.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_shipping_exact_threshold(self):\n        cost = self.calc.calculate_shipping(100.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_tax_valid(self):\n        tax = self.calc.calculate_tax(100.0)\n        self.assertEqual(tax, 23.0)\n\n    def test_calculate_tax_zero(self):\n        tax = self.calc.calculate_tax(0.0)\n        self.assertEqual(tax, 0.0)\n\n    def test_calculate_total_standard(self):\n        self.calc.add_item(\"Item\", 40.0, 2)\n        self.assertAlmostEqual(self.calc.calculate_total(), 108.4)\n\n    def test_calculate_total_discount_triggers_shipping(self):\n        self.calc.add_item(\"Item\", 110.0, 1)\n        self.assertAlmostEqual(self.calc.calculate_total(discount=20.0), 120.7)\n\n    def test_total_items_sum_quantities(self):\n        self.calc.add_item(\"A\", 10.0, 2)\n        self.calc.add_item(\"B\", 10.0, 3)\n        self.assertEqual(self.calc.total_items(), 5)\n\n    def test_list_items_names(self):\n        self.calc.add_item(\"A\", 1.0)\n        self.calc.add_item(\"B\", 1.0)\n        items = self.calc.list_items()\n        self.assertCountEqual(items, [\"A\", \"B\"])\n\n    def test_is_empty_new(self):\n        self.assertTrue(self.calc.is_empty())\n\n    def test_is_empty_after_add_remove(self):\n        self.calc.add_item(\"A\", 1.0)\n        self.assertFalse(self.calc.is_empty())\n        self.calc.remove_item(\"A\")\n        self.assertTrue(self.calc.is_empty())\n\n    def test_clear_order(self):\n        self.calc.add_item(\"A\", 10.0)\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n        self.assertEqual(self.calc.list_items(), [])\n\nif __name__ == '__main__':\n    unittest.main()\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calc = OrderCalculator()\n\n    def test_init_defaults(self):\n        self.assertEqual(self.calc.tax_rate, 0.23)\n        self.assertEqual(self.calc.free_shipping_threshold, 100.0)\n        self.assertEqual(self.calc.shipping_cost, 10.0)\n        self.assertTrue(self.calc.is_empty())\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.tax_rate, 0.1)\n        self.assertEqual(calc.free_shipping_threshold, 50.0)\n        self.assertEqual(calc.shipping_cost, 5.0)\n\n    def test_init_negative_values(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n        with self.assertRaises(ValueError):\n            OrderCalculator(free_shipping_threshold=-10.0)\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-5.0)\n\n    def test_add_item_valid(self):\n        self.calc.add_item(\"Apple\", 1.5, 10)\n        self.assertIn(\"Apple\", self.calc.list_items())\n        self.assertEqual(self.calc.total_items(), 10)\n        self.assertEqual(self.calc.get_subtotal(), 15.0)\n\n    def test_add_item_duplicate_update_quantity(self):\n        self.calc.add_item(\"Apple\", 1.5, 2)\n        self.calc.add_item(\"Apple\", 1.5, 3)\n        self.assertEqual(self.calc.total_items(), 5)\n        self.assertEqual(self.calc.get_subtotal(), 7.5)\n\n    def test_add_item_default_quantity(self):\n        self.calc.add_item(\"Banana\", 0.5)\n        self.assertEqual(self.calc.total_items(), 1)\n        self.assertEqual(self.calc.get_subtotal(), 0.5)\n\n    def test_add_item_invalid_price(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadPrice\", -1.0)\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"ZeroPrice\", 0.0)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"BadQty\", 10.0, -1)\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"ZeroQty\", 10.0, 0)\n\n    def test_add_item_empty_name(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"\", 10.0)\n\n    def test_remove_item_existing(self):\n        self.calc.add_item(\"Apple\", 1.0, 5)\n        self.calc.remove_item(\"Apple\")\n        self.assertTrue(self.calc.is_empty())\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_remove_item_non_existent(self):\n        with self.assertRaises(KeyError):\n            self.calc.remove_item(\"Ghost\")\n\n    def test_get_subtotal_multiple_items(self):\n        self.calc.add_item(\"A\", 10.0, 2)\n        self.calc.add_item(\"B\", 5.5, 1)\n        self.assertEqual(self.calc.get_subtotal(), 25.5)\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_get_subtotal_precision(self):\n        self.calc.add_item(\"A\", 0.1, 1)\n        self.calc.add_item(\"B\", 0.2, 1)\n        self.assertAlmostEqual(self.calc.get_subtotal(), 0.3)\n\n    def test_apply_discount_valid(self):\n        result = self.calc.apply_discount(100.0, 10.0)\n        self.assertEqual(result, 90.0)\n\n    def test_apply_discount_exceeds_subtotal(self):\n        result = self.calc.apply_discount(50.0, 60.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calc.apply_discount(100.0, -10.0)\n\n    def test_apply_discount_zero(self):\n        result = self.calc.apply_discount(100.0, 0.0)\n        self.assertEqual(result, 100.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        cost = self.calc.calculate_shipping(99.99)\n        self.assertEqual(cost, 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        cost = self.calc.calculate_shipping(150.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_shipping_exact_threshold(self):\n        cost = self.calc.calculate_shipping(100.0)\n        self.assertEqual(cost, 0.0)\n\n    def test_calculate_tax_valid(self):\n        tax = self.calc.calculate_tax(100.0)\n        self.assertEqual(tax, 23.0)\n\n    def test_calculate_tax_zero(self):\n        tax = self.calc.calculate_tax(0.0)\n        self.assertEqual(tax, 0.0)\n\n    def test_calculate_total_standard(self):\n        self.calc.add_item(\"Item\", 40.0, 2)\n        self.assertAlmostEqual(self.calc.calculate_total(), 108.4)\n\n    def test_calculate_total_discount_triggers_shipping(self):\n        self.calc.add_item(\"Item\", 110.0, 1)\n        self.assertAlmostEqual(self.calc.calculate_total(discount=20.0), 120.7)\n\n    def test_total_items_sum_quantities(self):\n        self.calc.add_item(\"A\", 10.0, 2)\n        self.calc.add_item(\"B\", 10.0, 3)\n        self.assertEqual(self.calc.total_items(), 5)\n\n    def test_list_items_names(self):\n        self.calc.add_item(\"A\", 1.0)\n        self.calc.add_item(\"B\", 1.0)\n        items = self.calc.list_items()\n        self.assertCountEqual(items, [\"A\", \"B\"])\n\n    def test_is_empty_new(self):\n        self.assertTrue(self.calc.is_empty())\n\n    def test_is_empty_after_add_remove(self):\n        self.calc.add_item(\"A\", 1.0)\n        self.assertFalse(self.calc.is_empty())\n        self.calc.remove_item(\"A\")\n        self.assertTrue(self.calc.is_empty())\n\n    def test_clear_order(self):\n        self.calc.add_item(\"A\", 10.0)\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n        self.assertEqual(self.calc.list_items(), [])\n\nif __name__ == '__main__':\n    unittest.main()\n```",
    "total_response_time": 132.2358021736145,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}