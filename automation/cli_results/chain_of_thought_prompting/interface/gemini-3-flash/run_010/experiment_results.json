{
  "model": "gemini-3-flash",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2025-12-29T02:50:04.644663",
  "response_time": 84.11373662948608,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-flash\\run_010\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I have analyzed the `OrderCalculator` class interface. Here is a breakdown of the components and logic that will be the focus of the test suite:\n\n### **1. Core Functionality & State**\n*   **Initialization**: The class manages configuration for `tax_rate`, `free_shipping_threshold`, and `shipping_cost`. Tests should verify that these defaults are applied and can be overridden.\n*   **Item Management**: `add_item`, `remove_item`, `clear_order`, and `is_empty` handle the internal state of the order.\n*   **Data Retrieval**: `total_items` and `list_items` provide views into the current order composition.\n\n### **2. Calculation Logic**\n*   **`get_subtotal`**: Calculates the sum of `price * quantity` for all items.\n*   **`apply_discount`**: Reduces a given amount by a discount value. (Assuming a flat amount based on the `float` type and `0.0` default).\n*   **`calculate_shipping`**: Implements threshold-based logic (free vs. standard cost).\n*   **`calculate_tax`**: Applies the `tax_rate` to a given amount.\n*   **`calculate_total`**: The primary integration method that combines subtotal, discount, tax, and shipping.\n\n### **3. Key Testing Areas**\n*   **Standard Flows**: Adding multiple items, calculating subtotal and total with/without discounts.\n*   **Boundary Conditions**:\n    *   Subtotal exactly at, just below, and just above the `free_shipping_threshold`.\n    *   Empty orders (subtotal should be 0.0, total might include shipping depending on implementation).\n*   **Edge Cases**:\n    *   Removing items that don't exist.\n    *   Adding items with zero or negative prices/quantities (input validation).\n    *   Applying a discount that exceeds the subtotal.\n*   **State Consistency**: Ensuring `total_items` and `is_empty` update correctly after additions, removals, and clearing.\n\nI am ready to proceed to the next step of defining specific test scenarios or writing the `unittest` code.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Here is a comprehensive list of unit test scenarios for the `OrderCalculator` class, categorized by method and case type.\n\n### **1. Initialization (`__init__`)**\n- **Scenario:** Initialize with default values (Normal).\n  - **Intent:** Verify that `tax_rate`, `free_shipping_threshold`, and `shipping_cost` are correctly set to 0.23, 100.0, and 10.0 respectively.\n- **Scenario:** Initialize with custom values (Normal).\n  - **Intent:** Verify that the class correctly stores user-provided values for all parameters.\n\n### **2. Item Management (`add_item`, `remove_item`, `clear_order`)**\n- **Scenario:** Add a single item with default quantity (Normal).\n  - **Intent:** Verify the item is stored and `total_items` returns 1.\n- **Scenario:** Add a single item with quantity > 1 (Normal).\n  - **Intent:** Verify quantity is correctly handled in calculations and item count.\n- **Scenario:** Add an item with a negative price (Invalid Input).\n  - **Intent:** Verify if the class raises a `ValueError` (input validation).\n- **Scenario:** Add an item with zero or negative quantity (Invalid Input).\n  - **Intent:** Verify if the class raises a `ValueError`.\n- **Scenario:** Add an item with an empty string as a name (Edge Case).\n  - **Intent:** Verify how the system handles empty identifiers.\n- **Scenario:** Add an item that already exists (Edge Case).\n  - **Intent:** Verify if it updates the existing item's quantity or adds a duplicate entry.\n- **Scenario:** Remove an existing item (Normal).\n  - **Intent:** Verify the item is completely removed and subtotal updates.\n- **Scenario:** Remove an item that does not exist (Exception/Edge Case).\n  - **Intent:** Verify if it raises a `KeyError` or handles it gracefully without crashing.\n- **Scenario:** Clear a non-empty order (Normal).\n  - **Intent:** Verify that all items are removed and `is_empty()` returns `True`.\n- **Scenario:** Clear an already empty order (Edge Case).\n  - **Intent:** Verify no errors occur.\n\n### **3. Subtotal and State Calculations (`get_subtotal`, `total_items`, `is_empty`)**\n- **Scenario:** `get_subtotal` on an empty order (Edge Case).\n  - **Intent:** Should return 0.0.\n- **Scenario:** `get_subtotal` with multiple items (Normal).\n  - **Intent:** Verify correct summation of `price * quantity` for all entries.\n- **Scenario:** `total_items` with multiple quantities (Normal).\n  - **Intent:** Verify it returns the sum of all quantities, not just the number of unique items.\n- **Scenario:** `is_empty` transitions (Normal).\n  - **Intent:** Verify it returns `True` initially, `False` after adding, and `True` again after removing/clearing.\n\n### **4. Financial Logic (`apply_discount`, `calculate_shipping`, `calculate_tax`)**\n- **Scenario:** Apply zero discount (Normal).\n  - **Intent:** Verify it returns the original subtotal.\n- **Scenario:** Apply a partial discount (Normal).\n  - **Intent:** Verify correct subtraction (e.g., 100.0 - 20.0 = 80.0).\n- **Scenario:** Apply a discount equal to the subtotal (Edge Case).\n  - **Intent:** Verify it returns 0.0.\n- **Scenario:** Apply a discount greater than the subtotal (Edge Case).\n  - **Intent:** Verify if it returns 0.0 or a negative value (business logic check).\n- **Scenario:** Apply a negative discount (Invalid Input).\n  - **Intent:** Verify if it raises an error or treats it as a surcharge.\n- **Scenario:** Calculate shipping for subtotal below threshold (Normal).\n  - **Intent:** Should return the full `shipping_cost`.\n- **Scenario:** Calculate shipping for subtotal exactly at threshold (Edge Case).\n  - **Intent:** Verify if shipping becomes free at the threshold (boundary test).\n- **Scenario:** Calculate shipping for subtotal above threshold (Normal).\n  - **Intent:** Should return 0.0.\n- **Scenario:** Calculate tax on a positive amount (Normal).\n  - **Intent:** Verify `amount * tax_rate` calculation.\n- **Scenario:** Calculate tax on zero amount (Edge Case).\n  - **Intent:** Should return 0.0.\n\n### **5. Integration (`calculate_total`)**\n- **Scenario:** Calculate total for a standard order without discount (Normal).\n  - **Intent:** Verify sequence: `(Subtotal + Shipping) * (1 + Tax)` or `(Subtotal * (1 + Tax)) + Shipping`. (Testing the order of operations).\n- **Scenario:** Calculate total with a discount (Normal).\n  - **Intent:** Verify that the discount is applied before tax/shipping calculations.\n- **Scenario:** Calculate total for an empty order (Edge Case).\n  - **Intent:** Verify if it returns 0.0 or just the shipping cost.\n\n### **6. Reporting (`list_items`)**\n- **Scenario:** List items in an empty order (Normal).\n  - **Intent:** Should return an empty list.\n- **Scenario:** List items in a populated order (Normal).\n  - **Intent:** Verify it returns a list containing all the names of added items.",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "import unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_defaults(self):\n        calc = OrderCalculator()\n        self.assertEqual(calc.get_subtotal(), 0.0)\n        self.assertTrue(calc.is_empty())\n\n    def test_init_custom(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.calculate_tax(100), 10.0)\n        self.assertEqual(calc.calculate_shipping(40), 5.0)\n        self.assertEqual(calc.calculate_shipping(60), 0.0)\n\n    def test_add_item_single_default_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.0)\n        self.assertEqual(self.calculator.total_items(), 1)\n        self.assertEqual(self.calculator.get_subtotal(), 1.0)\n\n    def test_add_item_multiple_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.0, 5)\n        self.assertEqual(self.calculator.total_items(), 5)\n        self.assertEqual(self.calculator.get_subtotal(), 5.0)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", -1.0)\n\n    def test_add_item_zero_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, 0)\n\n    def test_add_item_negative_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, -1)\n\n    def test_add_item_empty_name(self):\n        self.calculator.add_item(\"\", 1.0)\n        self.assertIn(\"\", self.calculator.list_items())\n\n    def test_add_item_existing_item_updates(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.add_item(\"Apple\", 1.0, 2)\n        self.assertEqual(self.calculator.total_items(), 3)\n\n    def test_remove_existing_item(self):\n        self.calculator.add_item(\"Apple\", 1.0)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_non_existing_item(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"Banana\")\n\n    def test_clear_populated_order(self):\n        self.calculator.add_item(\"Apple\", 1.0)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n        self.assertEqual(self.calculator.total_items(), 0)\n\n    def test_clear_empty_order(self):\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_get_subtotal_multiple_items(self):\n        self.calculator.add_item(\"Apple\", 1.0, 2)\n        self.calculator.add_item(\"Banana\", 2.0, 1)\n        self.assertEqual(self.calculator.get_subtotal(), 4.0)\n\n    def test_total_items_multiple_quantities(self):\n        self.calculator.add_item(\"Apple\", 1.0, 10)\n        self.calculator.add_item(\"Banana\", 2.0, 5)\n        self.assertEqual(self.calculator.total_items(), 15)\n\n    def test_is_empty_transitions(self):\n        self.assertTrue(self.calculator.is_empty())\n        self.calculator.add_item(\"Apple\", 1.0)\n        self.assertFalse(self.calculator.is_empty())\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_apply_discount_zero(self):\n        self.assertEqual(self.calculator.apply_discount(100.0, 0.0), 100.0)\n\n    def test_apply_discount_partial(self):\n        self.assertEqual(self.calculator.apply_discount(100.0, 20.0), 80.0)\n\n    def test_apply_discount_equal(self):\n        self.assertEqual(self.calculator.apply_discount(100.0, 100.0), 0.0)\n\n    def test_apply_discount_greater(self):\n        result = self.calculator.apply_discount(100.0, 150.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(50.0), 10.0)\n\n    def test_calculate_shipping_at_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_tax_positive(self):\n        self.assertAlmostEqual(self.calculator.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero(self):\n        self.assertEqual(self.calculator.calculate_tax(0.0), 0.0)\n\n    def test_calculate_total_no_discount(self):\n        self.calculator.add_item(\"Item\", 50.0, 1)\n        subtotal = 50.0\n        shipping = 10.0\n        expected_tax = (subtotal + shipping) * 0.23\n        expected_total = subtotal + shipping + expected_tax\n        self.assertAlmostEqual(self.calculator.calculate_total(), expected_total)\n\n    def test_calculate_total_with_discount(self):\n        self.calculator.add_item(\"Item\", 200.0, 1)\n        discount = 50.0\n        discounted_subtotal = 150.0\n        shipping = 0.0\n        expected_tax = (discounted_subtotal + shipping) * 0.23\n        expected_total = discounted_subtotal + shipping + expected_tax\n        self.assertAlmostEqual(self.calculator.calculate_total(discount=discount), expected_total)\n\n    def test_calculate_total_empty_order(self):\n        self.assertEqual(self.calculator.calculate_total(), 0.0)\n\n    def test_list_items_empty(self):\n        self.assertEqual(self.calculator.list_items(), [])\n\n    def test_list_items_populated(self):\n        items = [\"Apple\", \"Banana\", \"Cherry\"]\n        for item in items:\n            self.calculator.add_item(item, 1.0)\n        self.assertCountEqual(self.calculator.list_items(), items)\n\nif __name__ == '__main__':\n    unittest.main()",
        "response_time": 0
      }
    ],
    "final_response": "import unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_defaults(self):\n        calc = OrderCalculator()\n        self.assertEqual(calc.get_subtotal(), 0.0)\n        self.assertTrue(calc.is_empty())\n\n    def test_init_custom(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.calculate_tax(100), 10.0)\n        self.assertEqual(calc.calculate_shipping(40), 5.0)\n        self.assertEqual(calc.calculate_shipping(60), 0.0)\n\n    def test_add_item_single_default_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.0)\n        self.assertEqual(self.calculator.total_items(), 1)\n        self.assertEqual(self.calculator.get_subtotal(), 1.0)\n\n    def test_add_item_multiple_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.0, 5)\n        self.assertEqual(self.calculator.total_items(), 5)\n        self.assertEqual(self.calculator.get_subtotal(), 5.0)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", -1.0)\n\n    def test_add_item_zero_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, 0)\n\n    def test_add_item_negative_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, -1)\n\n    def test_add_item_empty_name(self):\n        self.calculator.add_item(\"\", 1.0)\n        self.assertIn(\"\", self.calculator.list_items())\n\n    def test_add_item_existing_item_updates(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.add_item(\"Apple\", 1.0, 2)\n        self.assertEqual(self.calculator.total_items(), 3)\n\n    def test_remove_existing_item(self):\n        self.calculator.add_item(\"Apple\", 1.0)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_non_existing_item(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"Banana\")\n\n    def test_clear_populated_order(self):\n        self.calculator.add_item(\"Apple\", 1.0)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n        self.assertEqual(self.calculator.total_items(), 0)\n\n    def test_clear_empty_order(self):\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_get_subtotal_multiple_items(self):\n        self.calculator.add_item(\"Apple\", 1.0, 2)\n        self.calculator.add_item(\"Banana\", 2.0, 1)\n        self.assertEqual(self.calculator.get_subtotal(), 4.0)\n\n    def test_total_items_multiple_quantities(self):\n        self.calculator.add_item(\"Apple\", 1.0, 10)\n        self.calculator.add_item(\"Banana\", 2.0, 5)\n        self.assertEqual(self.calculator.total_items(), 15)\n\n    def test_is_empty_transitions(self):\n        self.assertTrue(self.calculator.is_empty())\n        self.calculator.add_item(\"Apple\", 1.0)\n        self.assertFalse(self.calculator.is_empty())\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_apply_discount_zero(self):\n        self.assertEqual(self.calculator.apply_discount(100.0, 0.0), 100.0)\n\n    def test_apply_discount_partial(self):\n        self.assertEqual(self.calculator.apply_discount(100.0, 20.0), 80.0)\n\n    def test_apply_discount_equal(self):\n        self.assertEqual(self.calculator.apply_discount(100.0, 100.0), 0.0)\n\n    def test_apply_discount_greater(self):\n        result = self.calculator.apply_discount(100.0, 150.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(50.0), 10.0)\n\n    def test_calculate_shipping_at_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_tax_positive(self):\n        self.assertAlmostEqual(self.calculator.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero(self):\n        self.assertEqual(self.calculator.calculate_tax(0.0), 0.0)\n\n    def test_calculate_total_no_discount(self):\n        self.calculator.add_item(\"Item\", 50.0, 1)\n        subtotal = 50.0\n        shipping = 10.0\n        expected_tax = (subtotal + shipping) * 0.23\n        expected_total = subtotal + shipping + expected_tax\n        self.assertAlmostEqual(self.calculator.calculate_total(), expected_total)\n\n    def test_calculate_total_with_discount(self):\n        self.calculator.add_item(\"Item\", 200.0, 1)\n        discount = 50.0\n        discounted_subtotal = 150.0\n        shipping = 0.0\n        expected_tax = (discounted_subtotal + shipping) * 0.23\n        expected_total = discounted_subtotal + shipping + expected_tax\n        self.assertAlmostEqual(self.calculator.calculate_total(discount=discount), expected_total)\n\n    def test_calculate_total_empty_order(self):\n        self.assertEqual(self.calculator.calculate_total(), 0.0)\n\n    def test_list_items_empty(self):\n        self.assertEqual(self.calculator.list_items(), [])\n\n    def test_list_items_populated(self):\n        items = [\"Apple\", \"Banana\", \"Cherry\"]\n        for item in items:\n            self.calculator.add_item(item, 1.0)\n        self.assertCountEqual(self.calculator.list_items(), items)\n\nif __name__ == '__main__':\n    unittest.main()",
    "total_response_time": 84.11373662948608,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}