{
  "model": "gemini-3-flash",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2025-12-29T01:53:03.238362",
  "response_time": 97.38819646835327,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-flash\\run_005\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I have analyzed the `OrderCalculator` class interface. I am ready to proceed with identifying test scenarios and generating the unit tests.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Here are the unit test scenarios for the `OrderCalculator` class, organized by method and type of case:\n\n### 1. Constructor (`__init__`)\n- **Normal use:** Initialize with default parameters and verify that `tax_rate`, `free_shipping_threshold`, and `shipping_cost` are correctly assigned.\n- **Normal use:** Initialize with custom parameters (e.g., `tax_rate=0.05`, `shipping_cost=5.0`) and verify assignments.\n- **Invalid input:** Pass a negative `tax_rate`. Intent: Ensure the class raises a `ValueError` for nonsensical tax rates.\n- **Invalid input:** Pass a negative `shipping_cost`. Intent: Ensure the class raises a `ValueError`.\n\n### 2. Adding Items (`add_item`)\n- **Normal use:** Add a single item with default quantity (1) and verify it is stored.\n- **Normal use:** Add a single item with a specific quantity (e.g., 5).\n- **Normal use:** Add multiple different items and verify the internal state.\n- **Edge case:** Add an item that already exists in the order. Intent: Verify if it updates the quantity or replaces the item.\n- **Invalid input:** Add an item with an empty string name. Intent: Ensure it raises a `ValueError`.\n- **Invalid input:** Add an item with a negative price. Intent: Ensure it raises a `ValueError`.\n- **Invalid input:** Add an item with zero or negative quantity. Intent: Ensure it raises a `ValueError`.\n\n### 3. Removing Items (`remove_item`)\n- **Normal use:** Remove an existing item by name and verify it is no longer in the order.\n- **Exception:** Attempt to remove an item name that does not exist. Intent: Verify if it raises a `KeyError` or a custom exception.\n- **Edge case:** Remove an item from an empty order.\n\n### 4. Subtotal Calculation (`get_subtotal`)\n- **Normal use:** Calculate subtotal for an empty order (should return `0.0`).\n- **Normal use:** Calculate subtotal for multiple items with different quantities (e.g., `2 * 10.0 + 1 * 5.0 = 25.0`).\n- **Edge case:** Test precision with floating-point prices (e.g., adding `0.1` and `0.2` to check for rounding issues).\n\n### 5. Applying Discount (`apply_discount`)\n- **Normal use:** Apply a standard positive discount and verify the returned value.\n- **Edge case:** Apply a discount of `0.0`.\n- **Edge case:** Apply a discount equal to the subtotal (result should be `0.0`).\n- **Edge case:** Apply a discount greater than the subtotal. Intent: Verify if the result is capped at `0.0` or goes negative.\n- **Invalid input:** Apply a negative discount. Intent: Ensure it raises a `ValueError`.\n\n### 6. Shipping Calculation (`calculate_shipping`)\n- **Normal use:** Subtotal is below the `free_shipping_threshold`. Verify it returns the standard `shipping_cost`.\n- **Normal use:** Subtotal is above the `free_shipping_threshold`. Verify it returns `0.0`.\n- **Edge case:** Subtotal is exactly equal to the `free_shipping_threshold`. Intent: Verify the boundary condition (usually free).\n- **Edge case:** Subtotal is `0.0`. Intent: Verify if shipping is charged on an empty order.\n\n### 7. Tax Calculation (`calculate_tax`)\n- **Normal use:** Calculate tax on a positive amount using the initialized tax rate.\n- **Edge case:** Calculate tax on an amount of `0.0` (result should be `0.0`).\n- **Invalid input:** Calculate tax on a negative amount. Intent: Ensure it raises a `ValueError`.\n\n### 8. Total Calculation (`calculate_total`)\n- **Normal use:** Calculate the final total for an empty order (should be `0.0`).\n- **Normal use:** Calculate total for a standard order including tax and shipping.\n- **Normal use:** Calculate total with a discount applied, verifying the order of operations (e.g., discount applied before tax).\n- **Edge case:** Total calculation where the discount triggers free shipping (if threshold is checked on discounted subtotal).\n\n### 9. Item Counting (`total_items`)\n- **Normal use:** Verify it returns `0` for an empty order.\n- **Normal use:** Verify it returns the sum of all quantities (e.g., 2 items of A and 3 items of B should return `5`).\n\n### 10. Clearing Order (`clear_order`)\n- **Normal use:** Call `clear_order` on an order with items and verify `is_empty()` returns `True`.\n- **Edge case:** Call `clear_order` on an already empty order.\n\n### 11. Listing Items (`list_items`)\n- **Normal use:** Verify it returns an empty list for an empty order.\n- **Normal use:** Verify it returns a list containing the names of all added items.\n\n### 12. State Check (`is_empty`)\n- **Normal use:** Verify it returns `True` for a new instance.\n- **Normal use:** Verify it returns `False` after adding one item.\n- **Normal use:** Verify it returns `True` after removing the last item.",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_default_params(self):\n        calc = OrderCalculator()\n        self.assertEqual(calc.tax_rate, 0.23)\n        self.assertEqual(calc.free_shipping_threshold, 100.0)\n        self.assertEqual(calc.shipping_cost, 10.0)\n\n    def test_init_custom_params(self):\n        calc = OrderCalculator(tax_rate=0.05, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.tax_rate, 0.05)\n        self.assertEqual(calc.free_shipping_threshold, 50.0)\n        self.assertEqual(calc.shipping_cost, 5.0)\n\n    def test_init_negative_tax_rate_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n\n    def test_init_negative_shipping_cost_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-5.0)\n\n    def test_add_item_default_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.5)\n        self.assertIn(\"Apple\", self.calculator.list_items())\n        self.assertEqual(self.calculator.total_items(), 1)\n\n    def test_add_item_specific_quantity(self):\n        self.calculator.add_item(\"Banana\", 0.8, 5)\n        self.assertEqual(self.calculator.total_items(), 5)\n\n    def test_add_multiple_items(self):\n        self.calculator.add_item(\"Apple\", 1.5, 2)\n        self.calculator.add_item(\"Banana\", 0.8, 3)\n        self.assertEqual(self.calculator.total_items(), 5)\n        self.assertEqual(len(self.calculator.list_items()), 2)\n\n    def test_add_existing_item_updates_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.5, 1)\n        self.calculator.add_item(\"Apple\", 1.5, 2)\n        self.assertEqual(self.calculator.total_items(), 3)\n\n    def test_add_item_empty_name_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"\", 1.0)\n\n    def test_add_item_negative_price_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", -1.0)\n\n    def test_add_item_zero_quantity_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, 0)\n\n    def test_add_item_negative_quantity_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, -1)\n\n    def test_remove_existing_item(self):\n        self.calculator.add_item(\"Apple\", 1.5)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_non_existent_item_raises_key_error(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"NonExistent\")\n\n    def test_remove_item_from_empty_order_raises_key_error(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"Apple\")\n\n    def test_get_subtotal_empty_order(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_get_subtotal_multiple_items(self):\n        self.calculator.add_item(\"Apple\", 10.0, 2)\n        self.calculator.add_item(\"Banana\", 5.0, 1)\n        self.assertEqual(self.calculator.get_subtotal(), 25.0)\n\n    def test_get_subtotal_floating_point_precision(self):\n        self.calculator.add_item(\"Item1\", 0.1)\n        self.calculator.add_item(\"Item2\", 0.2)\n        self.assertAlmostEqual(self.calculator.get_subtotal(), 0.3, places=7)\n\n    def test_apply_discount_standard(self):\n        result = self.calculator.apply_discount(100.0, 10.0)\n        self.assertEqual(result, 90.0)\n\n    def test_apply_discount_zero(self):\n        result = self.calculator.apply_discount(100.0, 0.0)\n        self.assertEqual(result, 100.0)\n\n    def test_apply_discount_full(self):\n        result = self.calculator.apply_discount(100.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_over_subtotal_caps_at_zero(self):\n        result = self.calculator.apply_discount(100.0, 150.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(50.0), 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_shipping_equal_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_zero_subtotal(self):\n        self.assertEqual(self.calculator.calculate_shipping(0.0), 10.0)\n\n    def test_calculate_tax_positive_amount(self):\n        self.assertEqual(self.calculator.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero_amount(self):\n        self.assertEqual(self.calculator.calculate_tax(0.0), 0.0)\n\n    def test_calculate_tax_negative_amount_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.calculate_tax(-100.0)\n\n    def test_calculate_total_empty_order(self):\n        self.assertEqual(self.calculator.calculate_total(), 0.0)\n\n    def test_calculate_total_standard_order(self):\n        self.calculator.add_item(\"Item\", 50.0, 1)\n        self.assertEqual(self.calculator.calculate_total(), 71.5)\n\n    def test_calculate_total_with_discount_order_of_operations(self):\n        self.calculator.add_item(\"Item\", 100.0, 1)\n        self.assertEqual(self.calculator.calculate_total(discount=20.0), 108.4)\n\n    def test_calculate_total_discount_triggers_free_shipping(self):\n        self.calculator.add_item(\"Item\", 150.0, 1)\n        self.assertEqual(self.calculator.calculate_total(discount=60.0), 120.7)\n\n    def test_total_items_empty_order(self):\n        self.assertEqual(self.calculator.total_items(), 0)\n\n    def test_total_items_sum_of_quantities(self):\n        self.calculator.add_item(\"A\", 1.0, 2)\n        self.calculator.add_item(\"B\", 1.0, 3)\n        self.assertEqual(self.calculator.total_items(), 5)\n\n    def test_clear_order(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_clear_order_already_empty(self):\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_list_items_empty_order(self):\n        self.assertEqual(self.calculator.list_items(), [])\n\n    def test_list_items_with_items(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.calculator.add_item(\"B\", 1.0)\n        self.assertCountEqual(self.calculator.list_items(), [\"A\", \"B\"])\n\n    def test_is_empty_new_instance(self):\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_after_adding(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_is_empty_after_removing_last(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.calculator.remove_item(\"A\")\n        self.assertTrue(self.calculator.is_empty())\n\nif __name__ == '__main__':\n    unittest.main()\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_default_params(self):\n        calc = OrderCalculator()\n        self.assertEqual(calc.tax_rate, 0.23)\n        self.assertEqual(calc.free_shipping_threshold, 100.0)\n        self.assertEqual(calc.shipping_cost, 10.0)\n\n    def test_init_custom_params(self):\n        calc = OrderCalculator(tax_rate=0.05, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.tax_rate, 0.05)\n        self.assertEqual(calc.free_shipping_threshold, 50.0)\n        self.assertEqual(calc.shipping_cost, 5.0)\n\n    def test_init_negative_tax_rate_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n\n    def test_init_negative_shipping_cost_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-5.0)\n\n    def test_add_item_default_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.5)\n        self.assertIn(\"Apple\", self.calculator.list_items())\n        self.assertEqual(self.calculator.total_items(), 1)\n\n    def test_add_item_specific_quantity(self):\n        self.calculator.add_item(\"Banana\", 0.8, 5)\n        self.assertEqual(self.calculator.total_items(), 5)\n\n    def test_add_multiple_items(self):\n        self.calculator.add_item(\"Apple\", 1.5, 2)\n        self.calculator.add_item(\"Banana\", 0.8, 3)\n        self.assertEqual(self.calculator.total_items(), 5)\n        self.assertEqual(len(self.calculator.list_items()), 2)\n\n    def test_add_existing_item_updates_quantity(self):\n        self.calculator.add_item(\"Apple\", 1.5, 1)\n        self.calculator.add_item(\"Apple\", 1.5, 2)\n        self.assertEqual(self.calculator.total_items(), 3)\n\n    def test_add_item_empty_name_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"\", 1.0)\n\n    def test_add_item_negative_price_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", -1.0)\n\n    def test_add_item_zero_quantity_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, 0)\n\n    def test_add_item_negative_quantity_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, -1)\n\n    def test_remove_existing_item(self):\n        self.calculator.add_item(\"Apple\", 1.5)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_non_existent_item_raises_key_error(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"NonExistent\")\n\n    def test_remove_item_from_empty_order_raises_key_error(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"Apple\")\n\n    def test_get_subtotal_empty_order(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_get_subtotal_multiple_items(self):\n        self.calculator.add_item(\"Apple\", 10.0, 2)\n        self.calculator.add_item(\"Banana\", 5.0, 1)\n        self.assertEqual(self.calculator.get_subtotal(), 25.0)\n\n    def test_get_subtotal_floating_point_precision(self):\n        self.calculator.add_item(\"Item1\", 0.1)\n        self.calculator.add_item(\"Item2\", 0.2)\n        self.assertAlmostEqual(self.calculator.get_subtotal(), 0.3, places=7)\n\n    def test_apply_discount_standard(self):\n        result = self.calculator.apply_discount(100.0, 10.0)\n        self.assertEqual(result, 90.0)\n\n    def test_apply_discount_zero(self):\n        result = self.calculator.apply_discount(100.0, 0.0)\n        self.assertEqual(result, 100.0)\n\n    def test_apply_discount_full(self):\n        result = self.calculator.apply_discount(100.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_over_subtotal_caps_at_zero(self):\n        result = self.calculator.apply_discount(100.0, 150.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(50.0), 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_shipping_equal_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_zero_subtotal(self):\n        self.assertEqual(self.calculator.calculate_shipping(0.0), 10.0)\n\n    def test_calculate_tax_positive_amount(self):\n        self.assertEqual(self.calculator.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero_amount(self):\n        self.assertEqual(self.calculator.calculate_tax(0.0), 0.0)\n\n    def test_calculate_tax_negative_amount_raises_value_error(self):\n        with self.assertRaises(ValueError):\n            self.calculator.calculate_tax(-100.0)\n\n    def test_calculate_total_empty_order(self):\n        self.assertEqual(self.calculator.calculate_total(), 0.0)\n\n    def test_calculate_total_standard_order(self):\n        self.calculator.add_item(\"Item\", 50.0, 1)\n        self.assertEqual(self.calculator.calculate_total(), 71.5)\n\n    def test_calculate_total_with_discount_order_of_operations(self):\n        self.calculator.add_item(\"Item\", 100.0, 1)\n        self.assertEqual(self.calculator.calculate_total(discount=20.0), 108.4)\n\n    def test_calculate_total_discount_triggers_free_shipping(self):\n        self.calculator.add_item(\"Item\", 150.0, 1)\n        self.assertEqual(self.calculator.calculate_total(discount=60.0), 120.7)\n\n    def test_total_items_empty_order(self):\n        self.assertEqual(self.calculator.total_items(), 0)\n\n    def test_total_items_sum_of_quantities(self):\n        self.calculator.add_item(\"A\", 1.0, 2)\n        self.calculator.add_item(\"B\", 1.0, 3)\n        self.assertEqual(self.calculator.total_items(), 5)\n\n    def test_clear_order(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_clear_order_already_empty(self):\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_list_items_empty_order(self):\n        self.assertEqual(self.calculator.list_items(), [])\n\n    def test_list_items_with_items(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.calculator.add_item(\"B\", 1.0)\n        self.assertCountEqual(self.calculator.list_items(), [\"A\", \"B\"])\n\n    def test_is_empty_new_instance(self):\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_after_adding(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_is_empty_after_removing_last(self):\n        self.calculator.add_item(\"A\", 1.0)\n        self.calculator.remove_item(\"A\")\n        self.assertTrue(self.calculator.is_empty())\n\nif __name__ == '__main__':\n    unittest.main()\n```",
    "total_response_time": 97.38819646835327,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}