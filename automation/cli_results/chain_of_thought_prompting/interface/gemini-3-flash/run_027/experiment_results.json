{
  "model": "gemini-3-flash",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2025-12-30T02:53:37.118843",
  "response_time": 84.28947615623474,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-flash\\run_027\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I have analyzed the provided `OrderCalculator` class interface. Based on the method signatures and names, I have identified the following key areas for testing:\n\n1.  **State Management**: Methods like `add_item`, `remove_item`, `clear_order`, and `is_empty` manage the internal list of items. I will need to verify how the class handles duplicate items (e.g., does adding the same name twice increment quantity?), non-existent items during removal, and resetting the state.\n2.  **Calculations**: The core logic resides in `get_subtotal`, `apply_discount`, `calculate_shipping`, `calculate_tax`, and `calculate_total`. I will need to verify:\n    *   Subtotal calculation (price Ă— quantity).\n    *   Discount application (checking for edge cases like discounts exceeding the subtotal).\n    *   Shipping logic based on the `free_shipping_threshold`.\n    *   Tax calculation using the `tax_rate`.\n    *   The overall integration in `calculate_total`.\n3.  **Boundary & Edge Cases**: I will look for potential issues with zero or negative values for prices, quantities, tax rates, and discounts.\n4.  **Initial Configuration**: Verification that the `__init__` parameters correctly influence the subsequent calculations.\n\nI am ready for the next step.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Based on the `OrderCalculator` interface, here is a comprehensive list of unit test scenarios categorized by functionality:\n\n### 1. Initialization and Configuration (`__init__`)\n*   **Method:** `__init__`\n    *   **Normal Use:** Verify that the object initializes with default values for tax rate (0.23), threshold (100.0), and shipping cost (10.0).\n    *   **Normal Use:** Verify that the object correctly stores custom values passed to the constructor.\n    *   **Invalid Input:** Test behavior when negative values are provided for `tax_rate`, `free_shipping_threshold`, or `shipping_cost` (expect `ValueError` or logical handling).\n\n### 2. Item Management (`add_item`, `remove_item`, `clear_order`)\n*   **Method:** `add_item`\n    *   **Normal Use:** Add a single item and verify it exists in the order.\n    *   **Normal Use:** Add multiple different items and verify the count and total item quantity.\n    *   **Edge Case:** Add an item that already exists by name (verify if it updates quantity or adds a new entry).\n    *   **Invalid Input:** Add an item with a negative price (expect `ValueError`).\n    *   **Invalid Input:** Add an item with zero or negative quantity (expect `ValueError`).\n*   **Method:** `remove_item`\n    *   **Normal Use:** Remove an existing item and verify it is no longer in the list.\n    *   **Exception:** Attempt to remove an item that does not exist (expect `KeyError` or specific exception).\n*   **Method:** `clear_order`\n    *   **Normal Use:** Clear an order containing items and verify `is_empty()` returns `True`.\n    *   **Edge Case:** Call `clear_order` on an already empty calculator.\n\n### 3. State Inspection (`is_empty`, `total_items`, `list_items`)\n*   **Method:** `is_empty`\n    *   **Normal Use:** Returns `True` on a fresh instance.\n    *   **Normal Use:** Returns `False` after adding an item.\n    *   **Normal Use:** Returns `True` after adding and then removing the same item.\n*   **Method:** `total_items`\n    *   **Normal Use:** Returns the sum of quantities for all added items.\n    *   **Boundary Case:** Returns 0 for an empty order.\n*   **Method:** `list_items`\n    *   **Normal Use:** Returns a list of strings containing the names of added items.\n    *   **Boundary Case:** Returns an empty list for an empty order.\n\n### 4. Calculation Components (`get_subtotal`, `apply_discount`, `calculate_shipping`, `calculate_tax`)\n*   **Method:** `get_subtotal`\n    *   **Normal Use:** Calculate the sum of `price * quantity` for multiple items.\n    *   **Boundary Case:** Returns 0.0 for an empty order.\n*   **Method:** `apply_discount`\n    *   **Normal Use:** Apply a valid discount (e.g., 10.0 off 50.0) and verify the result (40.0).\n    *   **Boundary Case:** Apply a discount of 0.0 (result should equal subtotal).\n    *   **Edge Case:** Apply a discount equal to the subtotal (result should be 0.0).\n    *   **Edge Case:** Apply a discount greater than the subtotal (verify if it floors at 0.0 or allows negative).\n    *   **Invalid Input:** Apply a negative discount amount (expect `ValueError`).\n*   **Method:** `calculate_shipping`\n    *   **Normal Use:** Subtotal is below threshold (verify returns `shipping_cost`).\n    *   **Normal Use:** Subtotal is above threshold (verify returns 0.0).\n    *   **Boundary Case:** Subtotal is exactly equal to the threshold (verify inclusive/exclusive logic).\n    *   **Boundary Case:** Subtotal is 0.0 (verify if shipping is still charged).\n*   **Method:** `calculate_tax`\n    *   **Normal Use:** Calculate tax on a positive amount using the stored `tax_rate`.\n    *   **Boundary Case:** Calculate tax on an amount of 0.0 (result should be 0.0).\n\n### 5. Integrated Logic (`calculate_total`)\n*   **Method:** `calculate_total`\n    *   **Normal Use:** Calculate the final total including subtotal, a discount, shipping, and tax.\n    *   **Normal Use:** Calculate total with a discount that triggers free shipping (discounted subtotal vs threshold).\n    *   **Edge Case:** Calculate total for an empty order (verify if minimum costs like shipping/tax apply).\n    *   **Normal Use:** Verify that the calculation follows the correct order of operations (e.g., Subtotal -> Discount -> Shipping -> Tax or similar project convention).",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_default_values(self):\n        calc = OrderCalculator()\n        self.assertEqual(calc.calculate_tax(100.0), 23.0)\n        self.assertEqual(calc.calculate_shipping(50.0), 10.0)\n        self.assertEqual(calc.calculate_shipping(150.0), 0.0)\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.calculate_tax(100.0), 10.0)\n        self.assertEqual(calc.calculate_shipping(40.0), 5.0)\n        self.assertEqual(calc.calculate_shipping(60.0), 0.0)\n\n    def test_init_negative_values(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n        with self.assertRaises(ValueError):\n            OrderCalculator(free_shipping_threshold=-1.0)\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-1.0)\n\n    def test_add_item_single(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.assertIn(\"Apple\", self.calculator.list_items())\n        self.assertEqual(self.calculator.total_items(), 5)\n        self.assertEqual(self.calculator.get_subtotal(), 10.0)\n\n    def test_add_item_multiple(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.add_item(\"Banana\", 1.0, 10)\n        self.assertEqual(self.calculator.total_items(), 15)\n        self.assertEqual(self.calculator.get_subtotal(), 20.0)\n\n    def test_add_item_duplicate_name(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.add_item(\"Apple\", 2.0, 3)\n        self.assertEqual(self.calculator.total_items(), 8)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", -1.0, 1)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, 0)\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, -5)\n\n    def test_remove_item_existing(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_item_missing(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"NonExistent\")\n\n    def test_clear_order_populated(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n        self.assertEqual(self.calculator.total_items(), 0)\n\n    def test_clear_order_empty(self):\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_initial(self):\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_after_add(self):\n        self.calculator.add_item(\"Apple\", 2.0, 1)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_is_empty_after_remove(self):\n        self.calculator.add_item(\"Apple\", 2.0, 1)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_total_items_count(self):\n        self.calculator.add_item(\"Apple\", 1.0, 2)\n        self.calculator.add_item(\"Banana\", 1.0, 3)\n        self.assertEqual(self.calculator.total_items(), 5)\n\n    def test_total_items_empty(self):\n        self.assertEqual(self.calculator.total_items(), 0)\n\n    def test_list_items_names(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.add_item(\"Banana\", 1.0, 1)\n        items = self.calculator.list_items()\n        self.assertIn(\"Apple\", items)\n        self.assertIn(\"Banana\", items)\n        self.assertEqual(len(items), 2)\n\n    def test_list_items_empty(self):\n        self.assertEqual(self.calculator.list_items(), [])\n\n    def test_get_subtotal_calculation(self):\n        self.calculator.add_item(\"Apple\", 2.5, 2)\n        self.calculator.add_item(\"Banana\", 3.0, 1)\n        self.assertEqual(self.calculator.get_subtotal(), 8.0)\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_apply_discount_valid(self):\n        result = self.calculator.apply_discount(100.0, 20.0)\n        self.assertEqual(result, 80.0)\n\n    def test_apply_discount_zero(self):\n        result = self.calculator.apply_discount(100.0, 0.0)\n        self.assertEqual(result, 100.0)\n\n    def test_apply_discount_full(self):\n        result = self.calculator.apply_discount(100.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_excessive(self):\n        result = self.calculator.apply_discount(100.0, 150.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        calc = OrderCalculator(free_shipping_threshold=100.0, shipping_cost=10.0)\n        self.assertEqual(calc.calculate_shipping(99.0), 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        calc = OrderCalculator(free_shipping_threshold=100.0, shipping_cost=10.0)\n        self.assertEqual(calc.calculate_shipping(101.0), 0.0)\n\n    def test_calculate_shipping_at_threshold(self):\n        calc = OrderCalculator(free_shipping_threshold=100.0, shipping_cost=10.0)\n        self.assertEqual(calc.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_zero_subtotal(self):\n        calc = OrderCalculator(shipping_cost=10.0)\n        self.assertEqual(calc.calculate_shipping(0.0), 10.0)\n\n    def test_calculate_tax_positive(self):\n        calc = OrderCalculator(tax_rate=0.2)\n        self.assertEqual(calc.calculate_tax(100.0), 20.0)\n\n    def test_calculate_tax_zero(self):\n        self.assertEqual(self.calculator.calculate_tax(0.0), 0.0)\n\n    def test_calculate_total_integrated(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=100.0, shipping_cost=10.0)\n        calc.add_item(\"Widget\", 50.0, 1)\n        total = calc.calculate_total(discount=10.0)\n        expected_subtotal = 50.0\n        expected_discounted = 40.0\n        expected_shipping = 10.0\n        expected_tax = (expected_discounted + expected_shipping) * 0.1\n        self.assertAlmostEqual(total, expected_discounted + expected_shipping + expected_tax)\n\n    def test_calculate_total_discount_triggers_free_shipping(self):\n        calc = OrderCalculator(free_shipping_threshold=100.0, shipping_cost=10.0)\n        calc.add_item(\"Item\", 110.0, 1)\n        total_without_discount = calc.calculate_total(discount=0.0)\n        total_with_discount = calc.calculate_total(discount=20.0)\n        self.assertTrue(total_with_discount < total_without_discount)\n\n    def test_calculate_total_empty(self):\n        calc = OrderCalculator(tax_rate=0.2, shipping_cost=10.0)\n        total = calc.calculate_total()\n        expected_tax = 10.0 * 0.2\n        self.assertEqual(total, 10.0 + expected_tax)\n\nif __name__ == '__main__':\n    unittest.main()\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_default_values(self):\n        calc = OrderCalculator()\n        self.assertEqual(calc.calculate_tax(100.0), 23.0)\n        self.assertEqual(calc.calculate_shipping(50.0), 10.0)\n        self.assertEqual(calc.calculate_shipping(150.0), 0.0)\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.calculate_tax(100.0), 10.0)\n        self.assertEqual(calc.calculate_shipping(40.0), 5.0)\n        self.assertEqual(calc.calculate_shipping(60.0), 0.0)\n\n    def test_init_negative_values(self):\n        with self.assertRaises(ValueError):\n            OrderCalculator(tax_rate=-0.1)\n        with self.assertRaises(ValueError):\n            OrderCalculator(free_shipping_threshold=-1.0)\n        with self.assertRaises(ValueError):\n            OrderCalculator(shipping_cost=-1.0)\n\n    def test_add_item_single(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.assertIn(\"Apple\", self.calculator.list_items())\n        self.assertEqual(self.calculator.total_items(), 5)\n        self.assertEqual(self.calculator.get_subtotal(), 10.0)\n\n    def test_add_item_multiple(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.add_item(\"Banana\", 1.0, 10)\n        self.assertEqual(self.calculator.total_items(), 15)\n        self.assertEqual(self.calculator.get_subtotal(), 20.0)\n\n    def test_add_item_duplicate_name(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.add_item(\"Apple\", 2.0, 3)\n        self.assertEqual(self.calculator.total_items(), 8)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", -1.0, 1)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, 0)\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Apple\", 1.0, -5)\n\n    def test_remove_item_existing(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_item_missing(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"NonExistent\")\n\n    def test_clear_order_populated(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n        self.assertEqual(self.calculator.total_items(), 0)\n\n    def test_clear_order_empty(self):\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_initial(self):\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_after_add(self):\n        self.calculator.add_item(\"Apple\", 2.0, 1)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_is_empty_after_remove(self):\n        self.calculator.add_item(\"Apple\", 2.0, 1)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_total_items_count(self):\n        self.calculator.add_item(\"Apple\", 1.0, 2)\n        self.calculator.add_item(\"Banana\", 1.0, 3)\n        self.assertEqual(self.calculator.total_items(), 5)\n\n    def test_total_items_empty(self):\n        self.assertEqual(self.calculator.total_items(), 0)\n\n    def test_list_items_names(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.add_item(\"Banana\", 1.0, 1)\n        items = self.calculator.list_items()\n        self.assertIn(\"Apple\", items)\n        self.assertIn(\"Banana\", items)\n        self.assertEqual(len(items), 2)\n\n    def test_list_items_empty(self):\n        self.assertEqual(self.calculator.list_items(), [])\n\n    def test_get_subtotal_calculation(self):\n        self.calculator.add_item(\"Apple\", 2.5, 2)\n        self.calculator.add_item(\"Banana\", 3.0, 1)\n        self.assertEqual(self.calculator.get_subtotal(), 8.0)\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_apply_discount_valid(self):\n        result = self.calculator.apply_discount(100.0, 20.0)\n        self.assertEqual(result, 80.0)\n\n    def test_apply_discount_zero(self):\n        result = self.calculator.apply_discount(100.0, 0.0)\n        self.assertEqual(result, 100.0)\n\n    def test_apply_discount_full(self):\n        result = self.calculator.apply_discount(100.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_excessive(self):\n        result = self.calculator.apply_discount(100.0, 150.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        calc = OrderCalculator(free_shipping_threshold=100.0, shipping_cost=10.0)\n        self.assertEqual(calc.calculate_shipping(99.0), 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        calc = OrderCalculator(free_shipping_threshold=100.0, shipping_cost=10.0)\n        self.assertEqual(calc.calculate_shipping(101.0), 0.0)\n\n    def test_calculate_shipping_at_threshold(self):\n        calc = OrderCalculator(free_shipping_threshold=100.0, shipping_cost=10.0)\n        self.assertEqual(calc.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_zero_subtotal(self):\n        calc = OrderCalculator(shipping_cost=10.0)\n        self.assertEqual(calc.calculate_shipping(0.0), 10.0)\n\n    def test_calculate_tax_positive(self):\n        calc = OrderCalculator(tax_rate=0.2)\n        self.assertEqual(calc.calculate_tax(100.0), 20.0)\n\n    def test_calculate_tax_zero(self):\n        self.assertEqual(self.calculator.calculate_tax(0.0), 0.0)\n\n    def test_calculate_total_integrated(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=100.0, shipping_cost=10.0)\n        calc.add_item(\"Widget\", 50.0, 1)\n        total = calc.calculate_total(discount=10.0)\n        expected_subtotal = 50.0\n        expected_discounted = 40.0\n        expected_shipping = 10.0\n        expected_tax = (expected_discounted + expected_shipping) * 0.1\n        self.assertAlmostEqual(total, expected_discounted + expected_shipping + expected_tax)\n\n    def test_calculate_total_discount_triggers_free_shipping(self):\n        calc = OrderCalculator(free_shipping_threshold=100.0, shipping_cost=10.0)\n        calc.add_item(\"Item\", 110.0, 1)\n        total_without_discount = calc.calculate_total(discount=0.0)\n        total_with_discount = calc.calculate_total(discount=20.0)\n        self.assertTrue(total_with_discount < total_without_discount)\n\n    def test_calculate_total_empty(self):\n        calc = OrderCalculator(tax_rate=0.2, shipping_cost=10.0)\n        total = calc.calculate_total()\n        expected_tax = 10.0 * 0.2\n        self.assertEqual(total, 10.0 + expected_tax)\n\nif __name__ == '__main__':\n    unittest.main()\n```",
    "total_response_time": 84.28947615623474,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}