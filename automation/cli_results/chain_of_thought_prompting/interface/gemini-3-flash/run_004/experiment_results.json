{
  "model": "gemini-3-flash",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2025-12-29T01:40:52.608382",
  "response_time": 133.50200653076172,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-flash\\run_004\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I have analyzed the `OrderCalculator` class interface and identified the following key areas for testing:\n\n1.  **State Management**: Verification of `add_item`, `remove_item`, `clear_order`, `total_items`, and `is_empty` to ensure the internal state correctly tracks items and quantities.\n2.  **Subtotal Logic**: Calculation of the raw total before discounts, taxes, or shipping, handling multiple items and varying quantities.\n3.  **Discount Application**: Ensuring discounts are correctly subtracted and handling cases where the discount might exceed the subtotal.\n4.  **Shipping Calculations**: Validating the threshold logic (free shipping vs. flat rate) and how it responds to the subtotal after discounts.\n5.  **Taxation**: Verification of tax calculation based on the configured rate.\n6.  **Total Orchestration**: Testing `calculate_total` to ensure it correctly integrates subtotal, discount, shipping, and tax in the expected order.\n7.  **Edge Cases & Validation**: Handling of invalid inputs such as negative prices, negative quantities, or attempting to remove non-existent items.\n\nI am ready for the next step.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "Here is a comprehensive set of unit test scenarios for the `OrderCalculator` class, categorized by functional area.\n\n### 1. Initialization (`__init__`)\n- **Scenario 1.1 (Normal)**: Initialize with default parameters. Verify `tax_rate` is 0.23, `free_shipping_threshold` is 100.0, and `shipping_cost` is 10.0.\n- **Scenario 1.2 (Normal)**: Initialize with custom parameters. Verify that provided values for tax, threshold, and shipping cost are correctly stored.\n\n### 2. Adding Items (`add_item`)\n- **Scenario 2.1 (Normal)**: Add a single item with the default quantity (1). Verify the item is recorded correctly.\n- **Scenario 2.2 (Normal)**: Add an item with a specific quantity greater than 1.\n- **Scenario 2.3 (Normal)**: Add multiple different items. Verify all are present in the order.\n- **Scenario 2.4 (Normal)**: Add the same item name multiple times. Verify that the quantity is incremented (or handled according to implementation logic, e.g., updated).\n- **Scenario 2.5 (Invalid)**: Add an item with a negative price. Expect a `ValueError`.\n- **Scenario 2.6 (Invalid)**: Add an item with zero or negative quantity. Expect a `ValueError`.\n- **Scenario 2.7 (Invalid)**: Add an item with an empty string or whitespace as a name. Expect a `ValueError`.\n\n### 3. Removing Items (`remove_item`)\n- **Scenario 3.1 (Normal)**: Remove an existing item from the order. Verify it is no longer present.\n- **Scenario 3.2 (Exception)**: Attempt to remove an item that does not exist in the order. Expect a `KeyError` or a custom exception.\n\n### 4. Subtotal Calculation (`get_subtotal`)\n- **Scenario 4.1 (Normal)**: Calculate subtotal for an order with multiple items and varying quantities. Verify `price * quantity` summation.\n- **Scenario 4.2 (Edge)**: Calculate subtotal for an empty order. Expect `0.0`.\n\n### 5. Applying Discounts (`apply_discount`)\n- **Scenario 5.1 (Normal)**: Apply a valid positive discount. Verify the resulting amount is `subtotal - discount`.\n- **Scenario 5.2 (Edge)**: Apply a discount of `0.0`. Verify the amount remains unchanged.\n- **Scenario 5.3 (Edge)**: Apply a discount exactly equal to the subtotal. Verify the result is `0.0`.\n- **Scenario 5.4 (Edge)**: Apply a discount greater than the subtotal. Verify the result caps at `0.0` (assuming no negative subtotals).\n- **Scenario 5.5 (Invalid)**: Apply a negative discount value. Expect a `ValueError`.\n\n### 6. Shipping Calculation (`calculate_shipping`)\n- **Scenario 6.1 (Normal)**: Discounted subtotal is below the `free_shipping_threshold`. Verify it returns the full `shipping_cost`.\n- **Scenario 6.2 (Normal)**: Discounted subtotal is significantly above the `free_shipping_threshold`. Verify it returns `0.0`.\n- **Scenario 6.3 (Edge)**: Discounted subtotal is exactly equal to the `free_shipping_threshold`. Verify boundary behavior (typically free shipping).\n- **Scenario 6.4 (Edge)**: Discounted subtotal is `0.0` (empty order or fully discounted). Verify if shipping is still charged or is `0.0`.\n\n### 7. Tax Calculation (`calculate_tax`)\n- **Scenario 7.1 (Normal)**: Calculate tax for a positive amount. Verify `amount * tax_rate`.\n- **Scenario 7.2 (Edge)**: Calculate tax for an amount of `0.0`. Verify the result is `0.0`.\n- **Scenario 7.3 (Invalid)**: Calculate tax for a negative amount. Expect a `ValueError`.\n\n### 8. Total Calculation (`calculate_total`)\n- **Scenario 8.1 (Normal)**: Calculate the final total with no discount. Verify the sequence: Subtotal -> Shipping -> Tax (applied to subtotal + shipping).\n- **Scenario 8.2 (Normal)**: Calculate the final total with a valid discount.\n- **Scenario 8.3 (Edge)**: Calculate total for an empty order. Expect `0.0` or just the shipping cost depending on logic.\n- **Scenario 8.4 (Edge)**: Calculate total where the discount value is what pushes the subtotal below the free shipping threshold.\n\n### 9. Order State & Utility Methods\n- **Scenario 9.1 (Normal)**: `total_items` - Verify it returns the correct sum of all item quantities.\n- **Scenario 9.2 (Normal)**: `is_empty` - Verify it returns `True` for a new order and `False` after adding an item.\n- **Scenario 9.3 (Normal)**: `list_items` - Verify it returns a list containing all the added item names.\n- **Scenario 9.4 (Normal)**: `clear_order` - Verify that after calling this, `is_empty()` is `True` and `get_subtotal()` is `0.0`.\n\n### 10. Complex Scenarios\n- **Scenario 10.1 (Integration)**: Add items, remove one, add more, then calculate the total with a discount. Verify consistency of the internal state and final math.",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calc = OrderCalculator()\n\n    def test_init_default_values(self):\n        self.assertEqual(self.calc.tax_rate, 0.23)\n        self.assertEqual(self.calc.free_shipping_threshold, 100.0)\n        self.assertEqual(self.calc.shipping_cost, 10.0)\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.tax_rate, 0.1)\n        self.assertEqual(calc.free_shipping_threshold, 50.0)\n        self.assertEqual(calc.shipping_cost, 5.0)\n\n    def test_add_item_normal(self):\n        self.calc.add_item(\"Apple\", 10.0, 2)\n        self.assertEqual(self.calc.total_items(), 2)\n        self.assertIn(\"Apple\", self.calc.list_items())\n\n    def test_add_item_default_quantity(self):\n        self.calc.add_item(\"Banana\", 5.0)\n        self.assertEqual(self.calc.total_items(), 1)\n\n    def test_add_multiple_different_items(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.add_item(\"Banana\", 2.0, 1)\n        self.assertEqual(self.calc.total_items(), 2)\n        self.assertCountEqual(self.calc.list_items(), [\"Apple\", \"Banana\"])\n\n    def test_add_item_updates_quantity(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.add_item(\"Apple\", 1.0, 2)\n        self.assertEqual(self.calc.total_items(), 3)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"Apple\", -1.0)\n\n    def test_add_item_zero_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"Apple\", 1.0, 0)\n\n    def test_add_item_negative_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"Apple\", 1.0, -1)\n\n    def test_add_item_empty_name(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"\", 1.0)\n\n    def test_remove_item_success(self):\n        self.calc.add_item(\"Apple\", 1.0)\n        self.calc.remove_item(\"Apple\")\n        self.assertTrue(self.calc.is_empty())\n\n    def test_remove_item_not_found(self):\n        with self.assertRaises(KeyError):\n            self.calc.remove_item(\"NonExistent\")\n\n    def test_get_subtotal_calculation(self):\n        self.calc.add_item(\"A\", 10.0, 2)\n        self.calc.add_item(\"B\", 5.0, 3)\n        self.assertAlmostEqual(self.calc.get_subtotal(), 35.0)\n\n    def test_get_subtotal_empty_order(self):\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_apply_discount_positive(self):\n        self.assertAlmostEqual(self.calc.apply_discount(100.0, 20.0), 80.0)\n\n    def test_apply_discount_zero(self):\n        self.assertAlmostEqual(self.calc.apply_discount(100.0, 0.0), 100.0)\n\n    def test_apply_discount_exactly_subtotal(self):\n        self.assertAlmostEqual(self.calc.apply_discount(100.0, 100.0), 0.0)\n\n    def test_apply_discount_more_than_subtotal(self):\n        self.assertAlmostEqual(self.calc.apply_discount(100.0, 150.0), 0.0)\n\n    def test_apply_discount_negative_value(self):\n        with self.assertRaises(ValueError):\n            self.calc.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertAlmostEqual(self.calc.calculate_shipping(99.0), 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertAlmostEqual(self.calc.calculate_shipping(101.0), 0.0)\n\n    def test_calculate_shipping_exactly_threshold(self):\n        self.assertAlmostEqual(self.calc.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_zero_subtotal(self):\n        self.assertAlmostEqual(self.calc.calculate_shipping(0.0), 10.0)\n\n    def test_calculate_tax_normal_rate(self):\n        self.assertAlmostEqual(self.calc.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero_amount(self):\n        self.assertAlmostEqual(self.calc.calculate_tax(0.0), 0.0)\n\n    def test_calculate_tax_negative_amount(self):\n        with self.assertRaises(ValueError):\n            self.calc.calculate_tax(-10.0)\n\n    def test_calculate_total_no_discount(self):\n        self.calc.add_item(\"Item\", 50.0, 1)\n        self.assertAlmostEqual(self.calc.calculate_total(), 73.8)\n\n    def test_calculate_total_with_discount(self):\n        self.calc.add_item(\"Item\", 120.0, 1)\n        self.assertAlmostEqual(self.calc.calculate_total(30.0), 123.0)\n\n    def test_calculate_total_empty(self):\n        self.assertEqual(self.calc.calculate_total(), 0.0)\n\n    def test_calculate_total_free_shipping_case(self):\n        self.calc.add_item(\"Item\", 200.0, 1)\n        self.assertAlmostEqual(self.calc.calculate_total(), 246.0)\n\n    def test_total_items_multiple_calls(self):\n        self.calc.add_item(\"A\", 1.0, 5)\n        self.calc.add_item(\"B\", 1.0, 10)\n        self.assertEqual(self.calc.total_items(), 15)\n\n    def test_is_empty_lifecycle(self):\n        self.assertTrue(self.calc.is_empty())\n        self.calc.add_item(\"A\", 1.0)\n        self.assertFalse(self.calc.is_empty())\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n\n    def test_list_items_output(self):\n        self.calc.add_item(\"Item1\", 1.0)\n        self.calc.add_item(\"Item2\", 1.0)\n        self.assertCountEqual(self.calc.list_items(), [\"Item1\", \"Item2\"])\n\n    def test_clear_order_state(self):\n        self.calc.add_item(\"A\", 10.0, 10)\n        self.calc.clear_order()\n        self.assertEqual(self.calc.total_items(), 0)\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n        self.assertTrue(self.calc.is_empty())\n\n    def test_integration_add_remove_calculate(self):\n        self.calc.add_item(\"A\", 50.0, 2)\n        self.calc.add_item(\"B\", 10.0, 1)\n        self.calc.remove_item(\"B\")\n        self.assertAlmostEqual(self.calc.calculate_total(), 123.0)\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n\n    def setUp(self):\n        self.calc = OrderCalculator()\n\n    def test_init_default_values(self):\n        self.assertEqual(self.calc.tax_rate, 0.23)\n        self.assertEqual(self.calc.free_shipping_threshold, 100.0)\n        self.assertEqual(self.calc.shipping_cost, 10.0)\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        self.assertEqual(calc.tax_rate, 0.1)\n        self.assertEqual(calc.free_shipping_threshold, 50.0)\n        self.assertEqual(calc.shipping_cost, 5.0)\n\n    def test_add_item_normal(self):\n        self.calc.add_item(\"Apple\", 10.0, 2)\n        self.assertEqual(self.calc.total_items(), 2)\n        self.assertIn(\"Apple\", self.calc.list_items())\n\n    def test_add_item_default_quantity(self):\n        self.calc.add_item(\"Banana\", 5.0)\n        self.assertEqual(self.calc.total_items(), 1)\n\n    def test_add_multiple_different_items(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.add_item(\"Banana\", 2.0, 1)\n        self.assertEqual(self.calc.total_items(), 2)\n        self.assertCountEqual(self.calc.list_items(), [\"Apple\", \"Banana\"])\n\n    def test_add_item_updates_quantity(self):\n        self.calc.add_item(\"Apple\", 1.0, 1)\n        self.calc.add_item(\"Apple\", 1.0, 2)\n        self.assertEqual(self.calc.total_items(), 3)\n\n    def test_add_item_negative_price(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"Apple\", -1.0)\n\n    def test_add_item_zero_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"Apple\", 1.0, 0)\n\n    def test_add_item_negative_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"Apple\", 1.0, -1)\n\n    def test_add_item_empty_name(self):\n        with self.assertRaises(ValueError):\n            self.calc.add_item(\"\", 1.0)\n\n    def test_remove_item_success(self):\n        self.calc.add_item(\"Apple\", 1.0)\n        self.calc.remove_item(\"Apple\")\n        self.assertTrue(self.calc.is_empty())\n\n    def test_remove_item_not_found(self):\n        with self.assertRaises(KeyError):\n            self.calc.remove_item(\"NonExistent\")\n\n    def test_get_subtotal_calculation(self):\n        self.calc.add_item(\"A\", 10.0, 2)\n        self.calc.add_item(\"B\", 5.0, 3)\n        self.assertAlmostEqual(self.calc.get_subtotal(), 35.0)\n\n    def test_get_subtotal_empty_order(self):\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n\n    def test_apply_discount_positive(self):\n        self.assertAlmostEqual(self.calc.apply_discount(100.0, 20.0), 80.0)\n\n    def test_apply_discount_zero(self):\n        self.assertAlmostEqual(self.calc.apply_discount(100.0, 0.0), 100.0)\n\n    def test_apply_discount_exactly_subtotal(self):\n        self.assertAlmostEqual(self.calc.apply_discount(100.0, 100.0), 0.0)\n\n    def test_apply_discount_more_than_subtotal(self):\n        self.assertAlmostEqual(self.calc.apply_discount(100.0, 150.0), 0.0)\n\n    def test_apply_discount_negative_value(self):\n        with self.assertRaises(ValueError):\n            self.calc.apply_discount(100.0, -10.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertAlmostEqual(self.calc.calculate_shipping(99.0), 10.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertAlmostEqual(self.calc.calculate_shipping(101.0), 0.0)\n\n    def test_calculate_shipping_exactly_threshold(self):\n        self.assertAlmostEqual(self.calc.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_zero_subtotal(self):\n        self.assertAlmostEqual(self.calc.calculate_shipping(0.0), 10.0)\n\n    def test_calculate_tax_normal_rate(self):\n        self.assertAlmostEqual(self.calc.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero_amount(self):\n        self.assertAlmostEqual(self.calc.calculate_tax(0.0), 0.0)\n\n    def test_calculate_tax_negative_amount(self):\n        with self.assertRaises(ValueError):\n            self.calc.calculate_tax(-10.0)\n\n    def test_calculate_total_no_discount(self):\n        self.calc.add_item(\"Item\", 50.0, 1)\n        self.assertAlmostEqual(self.calc.calculate_total(), 73.8)\n\n    def test_calculate_total_with_discount(self):\n        self.calc.add_item(\"Item\", 120.0, 1)\n        self.assertAlmostEqual(self.calc.calculate_total(30.0), 123.0)\n\n    def test_calculate_total_empty(self):\n        self.assertEqual(self.calc.calculate_total(), 0.0)\n\n    def test_calculate_total_free_shipping_case(self):\n        self.calc.add_item(\"Item\", 200.0, 1)\n        self.assertAlmostEqual(self.calc.calculate_total(), 246.0)\n\n    def test_total_items_multiple_calls(self):\n        self.calc.add_item(\"A\", 1.0, 5)\n        self.calc.add_item(\"B\", 1.0, 10)\n        self.assertEqual(self.calc.total_items(), 15)\n\n    def test_is_empty_lifecycle(self):\n        self.assertTrue(self.calc.is_empty())\n        self.calc.add_item(\"A\", 1.0)\n        self.assertFalse(self.calc.is_empty())\n        self.calc.clear_order()\n        self.assertTrue(self.calc.is_empty())\n\n    def test_list_items_output(self):\n        self.calc.add_item(\"Item1\", 1.0)\n        self.calc.add_item(\"Item2\", 1.0)\n        self.assertCountEqual(self.calc.list_items(), [\"Item1\", \"Item2\"])\n\n    def test_clear_order_state(self):\n        self.calc.add_item(\"A\", 10.0, 10)\n        self.calc.clear_order()\n        self.assertEqual(self.calc.total_items(), 0)\n        self.assertEqual(self.calc.get_subtotal(), 0.0)\n        self.assertTrue(self.calc.is_empty())\n\n    def test_integration_add_remove_calculate(self):\n        self.calc.add_item(\"A\", 50.0, 2)\n        self.calc.add_item(\"B\", 10.0, 1)\n        self.calc.remove_item(\"B\")\n        self.assertAlmostEqual(self.calc.calculate_total(), 123.0)\n```",
    "total_response_time": 133.50200653076172,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}