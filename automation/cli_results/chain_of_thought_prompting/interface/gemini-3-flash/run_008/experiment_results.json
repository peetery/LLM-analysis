{
  "model": "gemini-3-flash",
  "strategy": "chain_of_thought_prompting",
  "context_type": "interface",
  "timestamp": "2025-12-29T02:27:59.954326",
  "response_time": 79.190514087677,
  "test_file": "cli_results\\chain_of_thought_prompting\\interface\\gemini-3-flash\\run_008\\tests.py",
  "raw_results": {
    "responses": [
      {
        "step": 1,
        "prompt": "You are a software testing assistant. Your task is to generate a set of unit tests for a Python class provided below.\n\nThe tests should:\n- use the `unittest` framework,\n- cover all public methods,\n- test typical usage as well as edge cases, invalid inputs, and exceptions,\n- be clear, atomic, and minimal.\n\nYou will now analyze the class to prepare relevant test cases.\nDo not write test code yet. Do not write test scenarios yet. Just analyze the class and prepare for the next step.\n\nBelow is the class interface (without implementation):\n\n```python\nfrom typing import TypedDict, List\n\nclass Item(TypedDict)\n\nclass OrderCalculator:\n    def __init__(self, tax_rate=0.23, free_shipping_threshold=100.0, shipping_cost=10.0):\n\ndef add_item(self, name: str, price: float, quantity: int = 1):\n\ndef remove_item(self, name: str):\n\ndef get_subtotal(self) -> float:\n\ndef apply_discount(self, subtotal: float, discount: float) -> float:\n\ndef calculate_shipping(self, discounted_subtotal: float) -> float:\n\ndef calculate_tax(self, amount: float) -> float:\n\ndef calculate_total(self, discount: float = 0.0) -> float:\n\ndef total_items(self) -> int:\n\ndef clear_order(self):\n\ndef list_items(self) -> List[str]:\n\ndef is_empty(self) -> bool:\n\n```\n\n",
        "response": "I will begin by analyzing the `OrderCalculator` class interface to identify its state, behaviors, and potential edge cases for testing.\n\n### Analysis of `OrderCalculator`\n\nBased on the interface provided, here is an analysis of the class's functionality:\n\n#### 1. State and Initialization\n*   **Attributes:** The constructor suggests the class tracks `tax_rate`, `free_shipping_threshold`, and `shipping_cost`. It likely maintains an internal list or dictionary of `Item` objects.\n*   **Defaults:** `tax_rate=0.23`, `free_shipping_threshold=100.0`, `shipping_cost=10.0`.\n\n#### 2. Item Management\n*   **`add_item`**: Adds an item with a name, price, and quantity. Needs to handle adding the same item multiple times (potentially updating quantity or adding a new entry).\n*   **`remove_item`**: Removes an item by name. Needs to handle cases where the item doesn't exist.\n*   **`clear_order`**: Resets the order state.\n*   **`list_items`**: Returns a list of item names.\n*   **`total_items`**: Returns the count. (Needs clarification if it's the sum of quantities or number of unique items; usually sum of quantities in an order calculator).\n*   **`is_empty`**: Boolean check for the presence of items.\n\n#### 3. Calculations\n*   **`get_subtotal`**: Sum of `price * quantity` for all items.\n*   **`apply_discount`**: Subtracts a discount from a subtotal.\n*   **`calculate_shipping`**: Logic depends on the `free_shipping_threshold`. If `discounted_subtotal >= threshold`, shipping is likely `0.0`, otherwise `shipping_cost`.\n*   **`calculate_tax`**: Applies `tax_rate` to a given amount.\n*   **`calculate_total`**: The orchestrator. Likely follows this flow: \n    1. Get subtotal.\n    2. Apply discount.\n    3. Calculate shipping based on discounted subtotal.\n    4. Apply tax (either on discounted subtotal or subtotal + shipping). \n    *Note: Standard e-commerce logic usually calculates tax on (discounted subtotal + shipping).*\n\n#### 4. Edge Cases and Invalid Inputs\n*   **Negative values:** Negative price, quantity, tax rate, or discount.\n*   **Empty order:** Calculating total when no items are added.\n*   **Threshold exactly:** Subtotal exactly equal to `free_shipping_threshold`.\n*   **Zero values:** Zero price or zero quantity.\n*   **Missing items:** Removing an item that was never added.\n\nI am ready to proceed with defining test scenarios in the next step.",
        "response_time": 0
      },
      {
        "step": 2,
        "prompt": "Based on the class above, list all relevant unit test scenarios you would create.\nEach scenario should describe:\n- the method being tested,\n- the type of case (e.g. normal use, invalid input, exception),\n- a short explanation of the intent.\nList as many scenarios as you can think of, covering all aspects of the class.\nDo not write test code yet.\n\n",
        "response": "I have identified the following unit test scenarios for the `OrderCalculator` class, categorized by method and case type.\n\n### 1. Initialization (`__init__`)\n*   **Normal (Default):** Verify that the calculator is initialized with the default tax rate (0.23), threshold (100.0), and shipping cost (10.0).\n*   **Normal (Custom):** Verify that custom values for tax rate, threshold, and shipping cost are correctly stored.\n\n### 2. Item Management (`add_item`, `remove_item`, `clear_order`)\n*   **`add_item` - Normal:** Add a single item and verify it exists in the order.\n*   **`add_item` - Multiple:** Add multiple different items and verify they are all recorded.\n*   **`add_item` - Duplicate:** Add an item with a name that already exists (Check: Does it increment quantity or create a new entry?).\n*   **`add_item` - Invalid Input:** Attempt to add an item with a negative price or zero/negative quantity (Check: Does it raise a `ValueError`?).\n*   **`remove_item` - Normal:** Remove an existing item and verify it is gone.\n*   **`remove_item` - Exception:** Attempt to remove an item that does not exist in the order (Check: Does it raise a `KeyError` or custom exception?).\n*   **`clear_order` - Normal:** Add items and then clear the order; verify the order is empty and subtotal is 0.0.\n\n### 3. State Inquiries (`total_items`, `list_items`, `is_empty`)\n*   **`total_items` - Normal:** Verify that the count correctly reflects the sum of all item quantities.\n*   **`list_items` - Normal:** Verify it returns a list containing all the names of added items.\n*   **`list_items` - Empty:** Verify it returns an empty list for a new order.\n*   **`is_empty` - Normal (True):** Verify it returns `True` on a fresh instance or after `clear_order`.\n*   **`is_empty` - Normal (False):** Verify it returns `False` after adding at least one item.\n\n### 4. Subtotal and Discount Logic (`get_subtotal`, `apply_discount`)\n*   **`get_subtotal` - Normal:** Calculate subtotal for multiple items with varying quantities (Sum of `price * quantity`).\n*   **`get_subtotal` - Empty:** Verify subtotal is 0.0 when no items are present.\n*   **`apply_discount` - Normal:** Apply a standard positive discount and verify the result.\n*   **`apply_discount` - Edge Case (Zero):** Apply a 0.0 discount and verify the subtotal remains unchanged.\n*   **`apply_discount` - Edge Case (Full):** Apply a discount equal to the subtotal (Verify result is 0.0).\n*   **`apply_discount` - Invalid Input:** Apply a negative discount or a discount larger than the subtotal (Check: Does it raise an error or floor the result at 0.0?).\n\n### 5. Shipping and Tax Calculations (`calculate_shipping`, `calculate_tax`)\n*   **`calculate_shipping` - Below Threshold:** Verify standard shipping cost is returned when subtotal is below the threshold.\n*   **`calculate_shipping` - At Threshold:** Verify if shipping becomes free (0.0) exactly at the `free_shipping_threshold`.\n*   **`calculate_shipping` - Above Threshold:** Verify shipping is 0.0 when subtotal exceeds the threshold.\n*   **`calculate_tax` - Normal:** Verify tax calculation based on the `tax_rate` for a given amount.\n*   **`calculate_tax` - Zero:** Verify tax is 0.0 for a 0.0 amount.\n\n### 6. Orchestration (`calculate_total`)\n*   **`calculate_total` - Normal (No Discount):** Verify the total: `(Subtotal + Shipping) + Tax` (assuming tax applies to the sum).\n*   **`calculate_total` - Normal (With Discount):** Verify total calculation when a discount is applied, affecting both the discounted subtotal and potential free shipping eligibility.\n*   **`calculate_total` - Empty Order:** Verify the total for an empty order (Check: Is it 0.0 or just the base shipping + tax?).\n*   **`calculate_total` - Free Shipping Case:** Verify total when the subtotal (after discount) qualifies for free shipping.\n*   **`calculate_total` - Paid Shipping Case:** Verify total when the subtotal (after discount) falls just below the threshold.\n\n### 7. Boundary and Type Cases\n*   **Large Values:** Test calculations with very large prices or quantities to check for precision/overflow issues.\n*   **Floating Point Precision:** Verify that calculations (like 0.1 + 0.2) are handled correctly without rounding errors affecting the final cent.",
        "response_time": 0
      },
      {
        "step": 3,
        "prompt": "Now, based on the test scenarios you just listed, generate the complete Python unit test suite using the `unittest` framework.\n\nFollow these rules:\n- Include one test method per scenario.\n- Use meaningful test method names.\n- Do not include comments or explanations.\n- Output a valid `.py` file containing only the test class.\n- IMPORTANT: Do NOT copy or redefine the OrderCalculator class in your test file. The class already exists in a separate module. Simply import it using: `from order_calculator import OrderCalculator`\n\nThe output must contain only Python code.",
        "response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_default_values(self):\n        calc = OrderCalculator()\n        self.assertEqual(calc.get_subtotal(), 0.0)\n        self.assertTrue(calc.is_empty())\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        calc.add_item(\"Test\", 40.0, 1)\n        self.assertEqual(calc.calculate_shipping(40.0), 5.0)\n        self.assertEqual(calc.calculate_tax(100.0), 10.0)\n\n    def test_add_item_normal(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.assertEqual(self.calculator.total_items(), 5)\n        self.assertIn(\"Apple\", self.calculator.list_items())\n\n    def test_add_item_multiple(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.add_item(\"Banana\", 1.0, 10)\n        self.assertEqual(self.calculator.total_items(), 15)\n        self.assertEqual(len(self.calculator.list_items()), 2)\n\n    def test_add_item_duplicate(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.add_item(\"Apple\", 2.0, 3)\n        self.assertEqual(self.calculator.total_items(), 8)\n\n    def test_add_item_invalid_price(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Broken\", -10.0, 1)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Broken\", 10.0, 0)\n\n    def test_remove_item_normal(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_item_non_existent(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"NonExistent\")\n\n    def test_clear_order(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_total_items_multiple(self):\n        self.calculator.add_item(\"A\", 1.0, 1)\n        self.calculator.add_item(\"B\", 1.0, 2)\n        self.assertEqual(self.calculator.total_items(), 3)\n\n    def test_list_items_normal(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.add_item(\"Banana\", 1.0, 1)\n        items = self.calculator.list_items()\n        self.assertIn(\"Apple\", items)\n        self.assertIn(\"Banana\", items)\n\n    def test_list_items_empty(self):\n        self.assertEqual(self.calculator.list_items(), [])\n\n    def test_is_empty_true(self):\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_false(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_get_subtotal_normal(self):\n        self.calculator.add_item(\"Apple\", 2.5, 2)\n        self.calculator.add_item(\"Banana\", 3.0, 3)\n        self.assertEqual(self.calculator.get_subtotal(), 14.0)\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_apply_discount_normal(self):\n        result = self.calculator.apply_discount(100.0, 20.0)\n        self.assertEqual(result, 80.0)\n\n    def test_apply_discount_zero(self):\n        result = self.calculator.apply_discount(100.0, 0.0)\n        self.assertEqual(result, 100.0)\n\n    def test_apply_discount_full(self):\n        result = self.calculator.apply_discount(100.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_apply_discount_exceeding_subtotal(self):\n        result = self.calculator.apply_discount(50.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(50.0), 10.0)\n\n    def test_calculate_shipping_at_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_tax_normal(self):\n        self.assertAlmostEqual(self.calculator.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero(self):\n        self.assertEqual(self.calculator.calculate_tax(0.0), 0.0)\n\n    def test_calculate_total_no_discount(self):\n        self.calculator.add_item(\"Gadget\", 50.0, 1)\n        subtotal = 50.0\n        shipping = 10.0\n        tax = (subtotal + shipping) * 0.23\n        expected = subtotal + shipping + tax\n        self.assertAlmostEqual(self.calculator.calculate_total(), expected)\n\n    def test_calculate_total_with_discount(self):\n        self.calculator.add_item(\"Gadget\", 100.0, 1)\n        discount = 20.0\n        discounted_subtotal = 80.0\n        shipping = 10.0\n        tax = (discounted_subtotal + shipping) * 0.23\n        expected = discounted_subtotal + shipping + tax\n        self.assertAlmostEqual(self.calculator.calculate_total(discount=discount), expected)\n\n    def test_calculate_total_empty_order(self):\n        self.assertEqual(self.calculator.calculate_total(), 0.0)\n\n    def test_calculate_total_free_shipping(self):\n        self.calculator.add_item(\"Premium\", 200.0, 1)\n        subtotal = 200.0\n        shipping = 0.0\n        tax = (subtotal + shipping) * 0.23\n        expected = subtotal + shipping + tax\n        self.assertAlmostEqual(self.calculator.calculate_total(), expected)\n\n    def test_calculate_total_paid_shipping(self):\n        self.calculator.add_item(\"Item\", 99.99, 1)\n        subtotal = 99.99\n        shipping = 10.0\n        tax = (subtotal + shipping) * 0.23\n        expected = subtotal + shipping + tax\n        self.assertAlmostEqual(self.calculator.calculate_total(), expected)\n\n    def test_precision_handling(self):\n        self.calculator.add_item(\"Small\", 0.1, 1)\n        self.calculator.add_item(\"Small\", 0.2, 1)\n        self.assertAlmostEqual(self.calculator.get_subtotal(), 0.3)\n\nif __name__ == '__main__':\n    unittest.main()\n```",
        "response_time": 0
      }
    ],
    "final_response": "```python\nimport unittest\nfrom order_calculator import OrderCalculator\n\nclass TestOrderCalculator(unittest.TestCase):\n    def setUp(self):\n        self.calculator = OrderCalculator()\n\n    def test_init_default_values(self):\n        calc = OrderCalculator()\n        self.assertEqual(calc.get_subtotal(), 0.0)\n        self.assertTrue(calc.is_empty())\n\n    def test_init_custom_values(self):\n        calc = OrderCalculator(tax_rate=0.1, free_shipping_threshold=50.0, shipping_cost=5.0)\n        calc.add_item(\"Test\", 40.0, 1)\n        self.assertEqual(calc.calculate_shipping(40.0), 5.0)\n        self.assertEqual(calc.calculate_tax(100.0), 10.0)\n\n    def test_add_item_normal(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.assertEqual(self.calculator.total_items(), 5)\n        self.assertIn(\"Apple\", self.calculator.list_items())\n\n    def test_add_item_multiple(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.add_item(\"Banana\", 1.0, 10)\n        self.assertEqual(self.calculator.total_items(), 15)\n        self.assertEqual(len(self.calculator.list_items()), 2)\n\n    def test_add_item_duplicate(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.add_item(\"Apple\", 2.0, 3)\n        self.assertEqual(self.calculator.total_items(), 8)\n\n    def test_add_item_invalid_price(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Broken\", -10.0, 1)\n\n    def test_add_item_invalid_quantity(self):\n        with self.assertRaises(ValueError):\n            self.calculator.add_item(\"Broken\", 10.0, 0)\n\n    def test_remove_item_normal(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.remove_item(\"Apple\")\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_remove_item_non_existent(self):\n        with self.assertRaises(KeyError):\n            self.calculator.remove_item(\"NonExistent\")\n\n    def test_clear_order(self):\n        self.calculator.add_item(\"Apple\", 2.0, 5)\n        self.calculator.clear_order()\n        self.assertTrue(self.calculator.is_empty())\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_total_items_multiple(self):\n        self.calculator.add_item(\"A\", 1.0, 1)\n        self.calculator.add_item(\"B\", 1.0, 2)\n        self.assertEqual(self.calculator.total_items(), 3)\n\n    def test_list_items_normal(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.calculator.add_item(\"Banana\", 1.0, 1)\n        items = self.calculator.list_items()\n        self.assertIn(\"Apple\", items)\n        self.assertIn(\"Banana\", items)\n\n    def test_list_items_empty(self):\n        self.assertEqual(self.calculator.list_items(), [])\n\n    def test_is_empty_true(self):\n        self.assertTrue(self.calculator.is_empty())\n\n    def test_is_empty_false(self):\n        self.calculator.add_item(\"Apple\", 1.0, 1)\n        self.assertFalse(self.calculator.is_empty())\n\n    def test_get_subtotal_normal(self):\n        self.calculator.add_item(\"Apple\", 2.5, 2)\n        self.calculator.add_item(\"Banana\", 3.0, 3)\n        self.assertEqual(self.calculator.get_subtotal(), 14.0)\n\n    def test_get_subtotal_empty(self):\n        self.assertEqual(self.calculator.get_subtotal(), 0.0)\n\n    def test_apply_discount_normal(self):\n        result = self.calculator.apply_discount(100.0, 20.0)\n        self.assertEqual(result, 80.0)\n\n    def test_apply_discount_zero(self):\n        result = self.calculator.apply_discount(100.0, 0.0)\n        self.assertEqual(result, 100.0)\n\n    def test_apply_discount_full(self):\n        result = self.calculator.apply_discount(100.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_apply_discount_negative(self):\n        with self.assertRaises(ValueError):\n            self.calculator.apply_discount(100.0, -10.0)\n\n    def test_apply_discount_exceeding_subtotal(self):\n        result = self.calculator.apply_discount(50.0, 100.0)\n        self.assertEqual(result, 0.0)\n\n    def test_calculate_shipping_below_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(50.0), 10.0)\n\n    def test_calculate_shipping_at_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(100.0), 0.0)\n\n    def test_calculate_shipping_above_threshold(self):\n        self.assertEqual(self.calculator.calculate_shipping(150.0), 0.0)\n\n    def test_calculate_tax_normal(self):\n        self.assertAlmostEqual(self.calculator.calculate_tax(100.0), 23.0)\n\n    def test_calculate_tax_zero(self):\n        self.assertEqual(self.calculator.calculate_tax(0.0), 0.0)\n\n    def test_calculate_total_no_discount(self):\n        self.calculator.add_item(\"Gadget\", 50.0, 1)\n        subtotal = 50.0\n        shipping = 10.0\n        tax = (subtotal + shipping) * 0.23\n        expected = subtotal + shipping + tax\n        self.assertAlmostEqual(self.calculator.calculate_total(), expected)\n\n    def test_calculate_total_with_discount(self):\n        self.calculator.add_item(\"Gadget\", 100.0, 1)\n        discount = 20.0\n        discounted_subtotal = 80.0\n        shipping = 10.0\n        tax = (discounted_subtotal + shipping) * 0.23\n        expected = discounted_subtotal + shipping + tax\n        self.assertAlmostEqual(self.calculator.calculate_total(discount=discount), expected)\n\n    def test_calculate_total_empty_order(self):\n        self.assertEqual(self.calculator.calculate_total(), 0.0)\n\n    def test_calculate_total_free_shipping(self):\n        self.calculator.add_item(\"Premium\", 200.0, 1)\n        subtotal = 200.0\n        shipping = 0.0\n        tax = (subtotal + shipping) * 0.23\n        expected = subtotal + shipping + tax\n        self.assertAlmostEqual(self.calculator.calculate_total(), expected)\n\n    def test_calculate_total_paid_shipping(self):\n        self.calculator.add_item(\"Item\", 99.99, 1)\n        subtotal = 99.99\n        shipping = 10.0\n        tax = (subtotal + shipping) * 0.23\n        expected = subtotal + shipping + tax\n        self.assertAlmostEqual(self.calculator.calculate_total(), expected)\n\n    def test_precision_handling(self):\n        self.calculator.add_item(\"Small\", 0.1, 1)\n        self.calculator.add_item(\"Small\", 0.2, 1)\n        self.assertAlmostEqual(self.calculator.get_subtotal(), 0.3)\n\nif __name__ == '__main__':\n    unittest.main()\n```",
    "total_response_time": 79.190514087677,
    "strategy": "chain_of_thought_prompting",
    "context_type": "interface"
  }
}